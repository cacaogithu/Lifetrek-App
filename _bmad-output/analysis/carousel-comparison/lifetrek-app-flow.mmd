graph TB
    subgraph "BMAD Architecture Planning"
        A[BMAD Workflow System] --> B[Architecture Decision Process]
        B --> C[Step 01: Init]
        B --> D[Step 02: Context]
        B --> E[Step 03: Decisions]
        C --> F[Separated Workflow Systems]
        D --> F
        E --> F
        F --> G[System 1: Content Generation]
        F --> H[System 2: LinkedIn Automation]
    end

    subgraph "Content Generation System - Current"
        G --> I[Direct Edge Function]
        I --> J[generate-linkedin-carousel/index.ts]
        J --> K{Action Type}
        K -->|Generate| L[Text Generation - MOCK]
        K -->|Regenerate Images| M[Use Existing Slides]
        L --> N[Mock Carousel Data]
        M --> N
    end

    subgraph "Image Generation Strategy"
        N --> O{Style Mode}
        O -->|text-heavy| P[Abstract Background Only]
        O -->|visual| Q[Detailed Scene]
        P --> R[Vertex AI - Imagen 3]
        Q --> R
        R --> S[Image System Prompt]
        S --> T[NO TEXT RULE]
        T --> U[Generate Base64 Image]
    end

    subgraph "Hybrid Rendering - DISABLED"
        U --> V{Text Overlay?}
        V -->|text-heavy mode| W[Satori Rendering]
        W --> X[HTML/CSS Template]
        X --> Y[SVG Generation]
        Y --> Z[Resvg to PNG]
        V -->|visual mode| AA[Raw Background]
        Z --> AB[DISABLED - Stability Issues]
        AB --> AC[Returns Raw Background]
    end

    subgraph "Local Compositing Alternative"
        AD[scripts/carouselCompositor.ts] --> AE[Sharp Library]
        AE --> AF[Load Base Image]
        AF --> AG[Create Gradient SVG]
        AG --> AH[Create Text SVG]
        AH --> AI[Load Logo]
        AI --> AJ[Composite Layers]
        AJ --> AK[Output PNG]
    end

    subgraph "Local Generation Script"
        AL[scripts/generate_carousel_local.ts] --> AM[Predefined Slides Config]
        AM --> AN[Load Facility Assets]
        AN --> AO[Smart Text Wrapping]
        AO --> AP[Alternating Text Position]
        AP --> AQ[Sharp Compositing]
        AQ --> AR[Generate Multiple Slides]
        AR --> AS[Save to Database]
    end

    subgraph "Async Job System - Future"
        H --> AT[linkedin_automation table]
        AT --> AU[Governor System]
        AU --> AV[pg_cron Scheduler]
        AV --> AW[Safety Checks]
        AW --> AX[Time Window 9am-9pm]
        AW --> AY[Daily Limits]
        AW --> AZ[Rate Limiting]
        AZ --> BA[Human Simulation]
        BA --> BB[Random Delays 20-40min]
    end

    subgraph "Research Outputs"
        BC[Technical Research] --> BD[Text-Heavy Carousels]
        BD --> BE[Satori + Deno Recommendation]
        BE --> BF[PDF First Strategy]
        BF --> BG[Programmatic Composition]
        BC --> BH[Google Cloud Agent Tools]
        BC --> BI[Internal Tools Architecture]
    end

    AC --> BJ[Return to Frontend]
    AK --> BJ
    AS --> BJ

    style A fill:#9B59B6
    style F fill:#E74C3C
    style R fill:#1A7A3E
    style AB fill:#E74C3C
    style AE fill:#4A90E2
    style AU fill:#F07818
