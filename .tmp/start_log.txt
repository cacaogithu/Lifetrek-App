open supabase/.temp/profile: no such file or directory
Supabase CLI 2.58.5
Using profile: supabase (supabase.co)
Loading project ref from file: supabase/.temp/project-ref
Starting database...
2025/12/16 11:10:33 PG Send: {"Type":"StartupMessage","ProtocolVersion":196608,"Parameters":{"database":"postgres","user":"postgres"}}
2025/12/16 11:10:33 PG Recv: {"Type":"AuthenticationSASL","AuthMechanisms":["SCRAM-SHA-256"]}
2025/12/16 11:10:33 PG Send: {"Type":"SASLInitialResponse","AuthMechanism":"SCRAM-SHA-256","Data":"n,,n=,r=n4e0G7sUP8MiFdJajrWOXb7N"}
2025/12/16 11:10:33 PG Recv: {"Type":"AuthenticationSASLContinue","Data":"r=n4e0G7sUP8MiFdJajrWOXb7NyThN5DDZ2+VsGcuf1f8MDXWC,s=57CjXrAVuU7WDvIayDQRqA==,i=4096"}
2025/12/16 11:10:33 PG Send: {"Type":"SASLResponse","Data":"c=biws,r=n4e0G7sUP8MiFdJajrWOXb7NyThN5DDZ2+VsGcuf1f8MDXWC,p=8Hb1F7anxebGppwlS0sfQWBCVv9gaC1nwHsRZr6aPL0="}
2025/12/16 11:10:33 PG Recv: {"Type":"AuthenticationSASLFinal","Data":"v=r8Y20KL8hzpsgyF9AdHXEM9IRO2cXUPBpVSf/xI5qao="}
2025/12/16 11:10:33 PG Recv: {"Type":"AuthenticationOK"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"in_hot_standby","Value":"off"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"integer_datetimes","Value":"on"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"TimeZone","Value":"UTC"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"IntervalStyle","Value":"postgres"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"is_superuser","Value":"off"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"application_name","Value":""}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"default_transaction_read_only","Value":"off"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"scram_iterations","Value":"4096"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"DateStyle","Value":"ISO, MDY"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"standard_conforming_strings","Value":"on"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"session_authorization","Value":"postgres"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"client_encoding","Value":"UTF8"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"server_version","Value":"17.6"}
2025/12/16 11:10:33 PG Recv: {"Type":"ParameterStatus","Name":"server_encoding","Value":"UTF8"}
2025/12/16 11:10:33 PG Recv: {"Type":"BackendKeyData","ProcessID":216,"SecretKey":224292939}
2025/12/16 11:10:33 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Initialising schema...
+ ulimit -n
+ '[' '!' -z '' ']'
+ export ERL_CRASH_DUMP=/tmp/erl_crash.dump
+ ERL_CRASH_DUMP=/tmp/erl_crash.dump
+ '[' false = true ']'
+ [[ -n '' ]]
+ echo 'Running migrations'
+ sudo -E -u nobody /app/bin/migrate
+ '[' true = true ']'
+ echo 'Seeding selfhosted Realtime'
+ sudo -E -u nobody /app/bin/realtime eval 'Realtime.Release.seeds(Realtime.Repo)'
[os_mon] cpu supervisor port (cpu_sup): Erlang has closed
[os_mon] memory supervisor port (memsup): Erlang has closed
+ echo 'Starting Realtime'
+ ulimit -n
+ exec /app/bin/realtime eval '{:ok, _} = Application.ensure_all_started(:realtime)
{:ok, _} = Realtime.Tenants.health_check("realtime-dev")'
[os_mon] cpu supervisor port (cpu_sup): Erlang has closed
[os_mon] memory supervisor port (memsup): Erlang has closed
Seeding globals from roles.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"SET lock_timeout = '4s'","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE SCHEMA IF NOT EXISTS supabase_migrations","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE TABLE IF NOT EXISTS supabase_migrations.schema_migrations (version text NOT NULL PRIMARY KEY)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE supabase_migrations.schema_migrations ADD COLUMN IF NOT EXISTS statements text[]","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE supabase_migrations.schema_migrations ADD COLUMN IF NOT EXISTS name text","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"SET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE SCHEMA"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251014120006_ebfeaf97-2173-46bb-aa57-644ab2671f44.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create analytics events table\nCREATE TABLE public.analytics_events (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  event_type TEXT NOT NULL CHECK (event_type IN ('chatbot_interaction', 'form_submission', 'lead_magnet_usage', 'consultation_scheduled')),\n  company_name TEXT,\n  company_email TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable Row Level Security\nALTER TABLE public.analytics_events ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create policy for inserting events (public can insert)\nCREATE POLICY \"Anyone can insert analytics events\" \nON public.analytics_events \nFOR INSERT \nWITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create policy for viewing events (only authenticated users)\nCREATE POLICY \"Only authenticated users can view analytics\" \nON public.analytics_events \nFOR SELECT \nUSING (auth.role() = 'authenticated')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create index for faster queries\nCREATE INDEX idx_analytics_events_type ON public.analytics_events(event_type)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_analytics_events_created_at ON public.analytics_events(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_analytics_events_company_email ON public.analytics_events(company_email)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create admin users table\nCREATE TABLE public.admin_users (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(user_id)\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable Row Level Security\nALTER TABLE public.admin_users ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create policy for admin access\nCREATE POLICY \"Admin users can view their own record\" \nON public.admin_users \nFOR SELECT \nUSING (auth.uid() = user_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251014120006"},{"text":"ebfeaf97-2173-46bb-aa57-644ab2671f44"},{"binary":"0000000100000000000000190000000a00000001000001892d2d2043726561746520616e616c7974696373206576656e7473207461626c650a435245415445205441424c45207075626c69632e616e616c79746963735f6576656e747320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a20206576656e745f747970652054455854204e4f54204e554c4c20434845434b20286576656e745f7479706520494e20282763686174626f745f696e746572616374696f6e272c2027666f726d5f7375626d697373696f6e272c20276c6561645f6d61676e65745f7573616765272c2027636f6e73756c746174696f6e5f7363686564756c65642729292c0a2020636f6d70616e795f6e616d6520544558542c0a2020636f6d70616e795f656d61696c20544558542c0a20206d65746164617461204a534f4e422c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a290000005a2d2d20456e61626c6520526f77204c6576656c2053656375726974790a414c544552205441424c45207075626c69632e616e616c79746963735f6576656e747320454e41424c4520524f57204c4556454c205345435552495459000000a72d2d2043726561746520706f6c69637920666f7220696e73657274696e67206576656e747320287075626c69632063616e20696e73657274290a43524541544520504f4c4943592022416e796f6e652063616e20696e7365727420616e616c7974696373206576656e747322200a4f4e207075626c69632e616e616c79746963735f6576656e7473200a464f5220494e53455254200a5749544820434845434b20287472756529000000c92d2d2043726561746520706f6c69637920666f722076696577696e67206576656e747320286f6e6c792061757468656e74696361746564207573657273290a43524541544520504f4c49435920224f6e6c792061757468656e746963617465642075736572732063616e207669657720616e616c797469637322200a4f4e207075626c69632e616e616c79746963735f6576656e7473200a464f522053454c454354200a5553494e472028617574682e726f6c652829203d202761757468656e746963617465642729000000702d2d2043726561746520696e64657820666f722066617374657220717565726965730a43524541544520494e444558206964785f616e616c79746963735f6576656e74735f74797065204f4e207075626c69632e616e616c79746963735f6576656e7473286576656e745f74797065290000005843524541544520494e444558206964785f616e616c79746963735f6576656e74735f637265617465645f6174204f4e207075626c69632e616e616c79746963735f6576656e747328637265617465645f61742044455343290000005943524541544520494e444558206964785f616e616c79746963735f6576656e74735f636f6d70616e795f656d61696c204f4e207075626c69632e616e616c79746963735f6576656e747328636f6d70616e795f656d61696c290000010e2d2d204372656174652061646d696e207573657273207461626c650a435245415445205441424c45207075626c69632e61646d696e5f757365727320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a2020757365725f69642055554944204e4f54204e554c4c205245464552454e43455320617574682e757365727328696429204f4e2044454c45544520434153434144452c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020554e4951554528757365725f6964290a29000000552d2d20456e61626c6520526f77204c6576656c2053656375726974790a414c544552205441424c45207075626c69632e61646d696e5f757365727320454e41424c4520524f57204c4556454c205345435552495459000000982d2d2043726561746520706f6c69637920666f722061646d696e206163636573730a43524541544520504f4c494359202241646d696e2075736572732063616e2076696577207468656972206f776e207265636f726422200a4f4e207075626c69632e61646d696e5f7573657273200a464f522053454c454354200a5553494e472028617574682e7569642829203d20757365725f696429"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251014134953_0672f8c7-81e8-4210-85f9-2308eb6a39a2.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create product_catalog table\nCREATE TABLE IF NOT EXISTS public.product_catalog (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name TEXT NOT NULL,\n  description TEXT,\n  category TEXT NOT NULL CHECK (category IN ('dental', 'medical', 'industrial')),\n  image_url TEXT NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.product_catalog ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Allow authenticated users to read all products\nCREATE POLICY \"Anyone can view products\"\n  ON public.product_catalog\n  FOR SELECT\n  USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Only authenticated users can insert products\nCREATE POLICY \"Authenticated users can insert products\"\n  ON public.product_catalog\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Only authenticated users can update products\nCREATE POLICY \"Authenticated users can update products\"\n  ON public.product_catalog\n  FOR UPDATE\n  TO authenticated\n  USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Only authenticated users can delete products\nCREATE POLICY \"Authenticated users can delete products\"\n  ON public.product_catalog\n  FOR DELETE\n  TO authenticated\n  USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create product-images storage bucket\nINSERT INTO storage.buckets (id, name, public)\nVALUES ('product-images', 'product-images', true)\nON CONFLICT (id) DO NOTHING","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Storage policies for product-images bucket\nCREATE POLICY \"Anyone can view product images\"\n  ON storage.objects\n  FOR SELECT\n  USING (bucket_id = 'product-images')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can upload product images\"\n  ON storage.objects\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (bucket_id = 'product-images')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can update product images\"\n  ON storage.objects\n  FOR UPDATE\n  TO authenticated\n  USING (bucket_id = 'product-images')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can delete product images\"\n  ON storage.objects\n  FOR DELETE\n  TO authenticated\n  USING (bucket_id = 'product-images')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create indexes for better performance\nCREATE INDEX IF NOT EXISTS idx_product_catalog_category ON public.product_catalog(category)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX IF NOT EXISTS idx_product_catalog_created_at ON public.product_catalog(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251014134953"},{"text":"0672f8c7-81e8-4210-85f9-2308eb6a39a2"},{"binary":"0000000100000000000000190000000d00000001000001512d2d204372656174652070726f647563745f636174616c6f67207461626c650a435245415445205441424c45204946204e4f5420455849535453207075626c69632e70726f647563745f636174616c6f6720280a202069642055554944205052494d415259204b45592044454641554c542067656e5f72616e646f6d5f7575696428292c0a20206e616d652054455854204e4f54204e554c4c2c0a20206465736372697074696f6e20544558542c0a202063617465676f72792054455854204e4f54204e554c4c20434845434b202863617465676f727920494e20282764656e74616c272c20276d65646963616c272c2027696e647573747269616c2729292c0a2020696d6167655f75726c2054455854204e4f54204e554c4c2c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54204e4f5728290a290000004a2d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e70726f647563745f636174616c6f6720454e41424c4520524f57204c4556454c205345435552495459000000922d2d20416c6c6f772061757468656e7469636174656420757365727320746f207265616420616c6c2070726f64756374730a43524541544520504f4c4943592022416e796f6e652063616e20766965772070726f6475637473220a20204f4e207075626c69632e70726f647563745f636174616c6f670a2020464f522053454c4543540a20205553494e4720287472756529000000b72d2d204f6e6c792061757468656e746963617465642075736572732063616e20696e736572742070726f64756374730a43524541544520504f4c494359202241757468656e746963617465642075736572732063616e20696e736572742070726f6475637473220a20204f4e207075626c69632e70726f647563745f636174616c6f670a2020464f5220494e534552540a2020544f2061757468656e746963617465640a20205749544820434845434b20287472756529000000b22d2d204f6e6c792061757468656e746963617465642075736572732063616e207570646174652070726f64756374730a43524541544520504f4c494359202241757468656e746963617465642075736572732063616e207570646174652070726f6475637473220a20204f4e207075626c69632e70726f647563745f636174616c6f670a2020464f52205550444154450a2020544f2061757468656e746963617465640a20205553494e4720287472756529000000b22d2d204f6e6c792061757468656e746963617465642075736572732063616e2064656c6574652070726f64756374730a43524541544520504f4c494359202241757468656e746963617465642075736572732063616e2064656c6574652070726f6475637473220a20204f4e207075626c69632e70726f647563745f636174616c6f670a2020464f522044454c4554450a2020544f2061757468656e746963617465640a20205553494e4720287472756529000000a42d2d204372656174652070726f647563742d696d616765732073746f72616765206275636b65740a494e5345525420494e544f2073746f726167652e6275636b657473202869642c206e616d652c207075626c6963290a56414c55455320282770726f647563742d696d61676573272c202770726f647563742d696d61676573272c2074727565290a4f4e20434f4e464c494354202869642920444f204e4f5448494e47000000a52d2d2053746f7261676520706f6c696369657320666f722070726f647563742d696d61676573206275636b65740a43524541544520504f4c4943592022416e796f6e652063616e20766965772070726f6475637420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f522053454c4543540a20205553494e4720286275636b65745f6964203d202770726f647563742d696d6167657327290000009e43524541544520504f4c494359202241757468656e746963617465642075736572732063616e2075706c6f61642070726f6475637420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f5220494e534552540a2020544f2061757468656e746963617465640a20205749544820434845434b20286275636b65745f6964203d202770726f647563742d696d6167657327290000009943524541544520504f4c494359202241757468656e746963617465642075736572732063616e207570646174652070726f6475637420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f52205550444154450a2020544f2061757468656e746963617465640a20205553494e4720286275636b65745f6964203d202770726f647563742d696d6167657327290000009943524541544520504f4c494359202241757468656e746963617465642075736572732063616e2064656c6574652070726f6475637420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f522044454c4554450a2020544f2061757468656e746963617465640a20205553494e4720286275636b65745f6964203d202770726f647563742d696d616765732729000000842d2d2043726561746520696e646578657320666f722062657474657220706572666f726d616e63650a43524541544520494e444558204946204e4f5420455849535453206964785f70726f647563745f636174616c6f675f63617465676f7279204f4e207075626c69632e70726f647563745f636174616c6f672863617465676f7279290000006443524541544520494e444558204946204e4f5420455849535453206964785f70726f647563745f636174616c6f675f637265617465645f6174204f4e207075626c69632e70726f647563745f636174616c6f6728637265617465645f6174204445534329"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251014140421_5a6dd97c-62ff-4872-9b19-9e3ea1890201.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create admin user with test credentials\n-- Note: In production, use proper signup flow and secure passwords\n\n-- First, we need to insert into auth.users (using a function since we can't directly insert into auth schema)\n-- Create a function to help create the admin user\nCREATE OR REPLACE FUNCTION create_admin_user()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n  admin_user_id uuid;\nBEGIN\n  -- Check if admin already exists\n  SELECT id INTO admin_user_id\n  FROM auth.users\n  WHERE email = 'admin@precisionparts.com';\n  \n  -- If not exists, we'll need to use the signup endpoint\n  -- For now, just ensure the admin_users table is ready\n  -- The user should sign up through the auth system first\n  \n  RAISE NOTICE 'Admin user setup ready. Please sign up with admin@precisionparts.com';\nEND;\n$$","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Execute the function\nSELECT create_admin_user()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Drop the function as it's no longer needed\nDROP FUNCTION create_admin_user()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251014140421"},{"text":"5a6dd97c-62ff-4872-9b19-9e3ea1890201"},{"binary":"00000001000000000000001900000003000000010000032c2d2d204372656174652061646d696e2075736572207769746820746573742063726564656e7469616c730a2d2d204e6f74653a20496e2070726f64756374696f6e2c207573652070726f706572207369676e757020666c6f7720616e64207365637572652070617373776f7264730a0a2d2d2046697273742c207765206e65656420746f20696e7365727420696e746f20617574682e757365727320287573696e6720612066756e6374696f6e2073696e63652077652063616e2774206469726563746c7920696e7365727420696e746f206175746820736368656d61290a2d2d2043726561746520612066756e6374696f6e20746f2068656c7020637265617465207468652061646d696e20757365720a435245415445204f52205245504c4143452046554e4354494f4e206372656174655f61646d696e5f7573657228290a52455455524e5320766f69640a4c414e475541474520706c706773716c0a534543555249545920444546494e45520a41532024240a4445434c4152450a202061646d696e5f757365725f696420757569643b0a424547494e0a20202d2d20436865636b2069662061646d696e20616c7265616479206578697374730a202053454c45435420696420494e544f2061646d696e5f757365725f69640a202046524f4d20617574682e75736572730a2020574845524520656d61696c203d202761646d696e40707265636973696f6e70617274732e636f6d273b0a20200a20202d2d204966206e6f74206578697374732c207765276c6c206e65656420746f2075736520746865207369676e757020656e64706f696e740a20202d2d20466f72206e6f772c206a75737420656e73757265207468652061646d696e5f7573657273207461626c652069732072656164790a20202d2d2054686520757365722073686f756c64207369676e207570207468726f7567682074686520617574682073797374656d2066697273740a20200a20205241495345204e4f54494345202741646d696e20757365722073657475702072656164792e20506c65617365207369676e20757020776974682061646d696e40707265636973696f6e70617274732e636f6d273b0a454e443b0a2424000000322d2d2045786563757465207468652066756e6374696f6e0a53454c454354206372656174655f61646d696e5f7573657228290000004f2d2d2044726f70207468652066756e6374696f6e2061732069742773206e6f206c6f6e676572206e65656465640a44524f502046554e4354494f4e206372656174655f61646d696e5f757365722829"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"create_admin_user","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":2278,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2025/12/16 11:10:40 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"Admin user setup ready. Please sign up with admin@precisionparts.com","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"PL/pgSQL function create_admin_user() line 14 at RAISE","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"pl_exec.c","Line":3911,"Routine":"exec_stmt_raise","UnknownFields":null}
NOTICE (00000): Admin user setup ready. Please sign up with admin@precisionparts.com
2025/12/16 11:10:40 PG Recv: {"Type":"DataRow","Values":[{"text":""}]}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251014140756_0838f4cd-b160-4f11-ac33-73122d389ca5.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Drop existing INSERT policy\nDROP POLICY IF EXISTS \"Users can insert their own admin record\" ON public.admin_users","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create new policy allowing users to insert themselves as admin during development\nCREATE POLICY \"Users can insert their own admin record\"\n  ON public.admin_users\n  FOR INSERT\n  WITH CHECK (auth.uid() = user_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Also allow users to check if they are admin\nDROP POLICY IF EXISTS \"Admin users can view their own record\" ON public.admin_users","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Users can view their own admin record\"\n  ON public.admin_users\n  FOR SELECT\n  USING (auth.uid() = user_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251014140756"},{"text":"0838f4cd-b160-4f11-ac33-73122d389ca5"},{"binary":"0000000100000000000000190000000400000001000000742d2d2044726f70206578697374696e6720494e5345525420706f6c6963790a44524f5020504f4c49435920494620455849535453202255736572732063616e20696e73657274207468656972206f776e2061646d696e207265636f726422204f4e207075626c69632e61646d696e5f7573657273000000d52d2d20437265617465206e657720706f6c69637920616c6c6f77696e6720757365727320746f20696e73657274207468656d73656c7665732061732061646d696e20647572696e6720646576656c6f706d656e740a43524541544520504f4c494359202255736572732063616e20696e73657274207468656972206f776e2061646d696e207265636f7264220a20204f4e207075626c69632e61646d696e5f75736572730a2020464f5220494e534552540a20205749544820434845434b2028617574682e7569642829203d20757365725f696429000000822d2d20416c736f20616c6c6f7720757365727320746f20636865636b2069662074686579206172652061646d696e0a44524f5020504f4c49435920494620455849535453202241646d696e2075736572732063616e2076696577207468656972206f776e207265636f726422204f4e207075626c69632e61646d696e5f75736572730000007943524541544520504f4c494359202255736572732063616e2076696577207468656972206f776e2061646d696e207265636f7264220a20204f4e207075626c69632e61646d696e5f75736572730a2020464f522053454c4543540a20205553494e472028617574682e7569642829203d20757365725f696429"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"Users can insert their own admin record\" for relation \"public.admin_users\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "Users can insert their own admin record" for relation "public.admin_users" does not exist, skipping
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251014145210_ffeb353e-0933-4a02-b8eb-c491aaaa938e.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Fix Critical Security Issue: Remove self-promotion admin access\n-- Drop the dangerous INSERT policy that allows any user to make themselves admin\nDROP POLICY IF EXISTS \"Users can insert their own admin record\" ON public.admin_users","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Also drop the SELECT policy as it's not needed (admins are checked server-side)\nDROP POLICY IF EXISTS \"Users can view their own admin record\" ON public.admin_users","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create a secure admin account\n-- First, we need to ensure the auth user exists, then add to admin_users\n-- Note: This assumes the auth user admin@precisionparts.com already exists\n-- If not, it will need to be created manually via Supabase dashboard\n\n-- Insert admin record (will only work if the auth user exists)\n-- Using ON CONFLICT to avoid errors if already exists\nINSERT INTO public.admin_users (user_id)\nSELECT id FROM auth.users WHERE email = 'admin@precisionparts.com'\nON CONFLICT (user_id) DO NOTHING","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add a comment explaining the security model\nCOMMENT ON TABLE public.admin_users IS 'Admin users table. New admins can only be added via migrations or superuser access. No INSERT policy to prevent privilege escalation.'","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251014145210"},{"text":"ffeb353e-0933-4a02-b8eb-c491aaaa938e"},{"binary":"0000000100000000000000190000000400000001000000ea2d2d2046697820437269746963616c2053656375726974792049737375653a2052656d6f76652073656c662d70726f6d6f74696f6e2061646d696e206163636573730a2d2d2044726f70207468652064616e6765726f757320494e5345525420706f6c696379207468617420616c6c6f777320616e79207573657220746f206d616b65207468656d73656c7665732061646d696e0a44524f5020504f4c49435920494620455849535453202255736572732063616e20696e73657274207468656972206f776e2061646d696e207265636f726422204f4e207075626c69632e61646d696e5f7573657273000000a62d2d20416c736f2064726f70207468652053454c45435420706f6c6963792061732069742773206e6f74206e6565646564202861646d696e732061726520636865636b6564207365727665722d73696465290a44524f5020504f4c49435920494620455849535453202255736572732063616e2076696577207468656972206f776e2061646d696e207265636f726422204f4e207075626c69632e61646d696e5f7573657273000002012d2d204372656174652061207365637572652061646d696e206163636f756e740a2d2d2046697273742c207765206e65656420746f20656e737572652074686520617574682075736572206578697374732c207468656e2061646420746f2061646d696e5f75736572730a2d2d204e6f74653a205468697320617373756d657320746865206175746820757365722061646d696e40707265636973696f6e70617274732e636f6d20616c7265616479206578697374730a2d2d204966206e6f742c2069742077696c6c206e65656420746f2062652063726561746564206d616e75616c6c79207669612053757061626173652064617368626f6172640a0a2d2d20496e736572742061646d696e207265636f7264202877696c6c206f6e6c7920776f726b206966207468652061757468207573657220657869737473290a2d2d205573696e67204f4e20434f4e464c49435420746f2061766f6964206572726f727320696620616c7265616479206578697374730a494e5345525420494e544f207075626c69632e61646d696e5f75736572732028757365725f6964290a53454c4543542069642046524f4d20617574682e757365727320574845524520656d61696c203d202761646d696e40707265636973696f6e70617274732e636f6d270a4f4e20434f4e464c4943542028757365725f69642920444f204e4f5448494e47000000dd2d2d20416464206120636f6d6d656e74206578706c61696e696e6720746865207365637572697479206d6f64656c0a434f4d4d454e54204f4e205441424c45207075626c69632e61646d696e5f7573657273204953202741646d696e207573657273207461626c652e204e65772061646d696e732063616e206f6e6c7920626520616464656420766961206d6967726174696f6e73206f7220737570657275736572206163636573732e204e6f20494e5345525420706f6c69637920746f2070726576656e742070726976696c65676520657363616c6174696f6e2e27"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 0"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115040400_pre_fix_has_role.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create app_role type if it doesn't exist\nDO $$ BEGIN\n    CREATE TYPE public.app_role AS ENUM ('admin', 'user');\nEXCEPTION\n    WHEN duplicate_object THEN null;\nEND $$","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create admin_users table if it doesn't exist\nCREATE TABLE IF NOT EXISTS public.admin_users (\n    id uuid NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    user_id uuid REFERENCES auth.users(id) NOT NULL,\n    role public.app_role NOT NULL DEFAULT 'user'::public.app_role,\n    created_at timestamptz DEFAULT now(),\n    updated_at timestamptz DEFAULT now(),\n    UNIQUE(user_id)\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS on admin_users\nALTER TABLE public.admin_users ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create has_role function (String version)\nCREATE OR REPLACE FUNCTION public.has_role(user_id uuid, role_name text)\nRETURNS boolean AS $$\nBEGIN\n  RETURN EXISTS (\n    SELECT 1 \n    FROM public.admin_users \n    WHERE public.admin_users.user_id = has_role.user_id \n    AND public.admin_users.role = has_role.role_name\n  );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create has_role function (Enum version)\nCREATE OR REPLACE FUNCTION public.has_role(user_id uuid, role_name public.app_role)\nRETURNS boolean AS $$\nBEGIN\n  -- Cast enum to text to reuse logic or just compare\n  RETURN EXISTS (\n    SELECT 1 \n    FROM public.admin_users \n    WHERE public.admin_users.user_id = has_role.user_id \n    AND public.admin_users.role = has_role.role_name::text\n  );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115040400"},{"text":"pre_fix_has_role"},{"binary":"0000000100000000000000190000000500000001000000a82d2d20437265617465206170705f726f6c65207479706520696620697420646f65736e27742065786973740a444f20242420424547494e0a202020204352454154452054595045207075626c69632e6170705f726f6c6520415320454e554d20282761646d696e272c20277573657227293b0a455843455054494f4e0a202020205748454e206475706c69636174655f6f626a656374205448454e206e756c6c3b0a454e442024240000017d2d2d204372656174652061646d696e5f7573657273207461626c6520696620697420646f65736e27742065786973740a435245415445205441424c45204946204e4f5420455849535453207075626c69632e61646d696e5f757365727320280a2020202069642075756964204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a20202020757365725f69642075756964205245464552454e43455320617574682e757365727328696429204e4f54204e554c4c2c0a20202020726f6c65207075626c69632e6170705f726f6c65204e4f54204e554c4c2044454641554c54202775736572273a3a7075626c69632e6170705f726f6c652c0a20202020637265617465645f61742074696d657374616d70747a2044454641554c54206e6f7728292c0a20202020757064617465645f61742074696d657374616d70747a2044454641554c54206e6f7728292c0a20202020554e4951554528757365725f6964290a29000000552d2d20456e61626c6520524c53206f6e2061646d696e5f75736572730a414c544552205441424c45207075626c69632e61646d696e5f757365727320454e41424c4520524f57204c4556454c2053454355524954590000016b2d2d20437265617465206861735f726f6c652066756e6374696f6e2028537472696e672076657273696f6e290a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e6861735f726f6c6528757365725f696420757569642c20726f6c655f6e616d652074657874290a52455455524e5320626f6f6c65616e2041532024240a424547494e0a202052455455524e2045584953545320280a2020202053454c4543542031200a2020202046524f4d207075626c69632e61646d696e5f7573657273200a202020205748455245207075626c69632e61646d696e5f75736572732e757365725f6964203d206861735f726f6c652e757365725f6964200a20202020414e44207075626c69632e61646d696e5f75736572732e726f6c65203d206861735f726f6c652e726f6c655f6e616d650a2020293b0a454e443b0a2424204c414e475541474520706c706773716c20534543555249545920444546494e4552000001b02d2d20437265617465206861735f726f6c652066756e6374696f6e2028456e756d2076657273696f6e290a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e6861735f726f6c6528757365725f696420757569642c20726f6c655f6e616d65207075626c69632e6170705f726f6c65290a52455455524e5320626f6f6c65616e2041532024240a424547494e0a20202d2d204361737420656e756d20746f207465787420746f207265757365206c6f676963206f72206a75737420636f6d706172650a202052455455524e2045584953545320280a2020202053454c4543542031200a2020202046524f4d207075626c69632e61646d696e5f7573657273200a202020205748455245207075626c69632e61646d696e5f75736572732e757365725f6964203d206861735f726f6c652e757365725f6964200a20202020414e44207075626c69632e61646d696e5f75736572732e726f6c65203d206861735f726f6c652e726f6c655f6e616d653a3a746578740a2020293b0a454e443b0a2424204c414e475541474520706c706773716c20534543555249545920444546494e4552"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42P07","Message":"relation \"admin_users\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"parse_utilcmd.c","Line":207,"Routine":"transformCreateStmt","UnknownFields":null}
NOTICE (42P07): relation "admin_users" already exists, skipping
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115040403_6b4ad4c8-537f-4d3f-99f9-5147d1a8d562.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create enum for lead status\nCREATE TYPE public.lead_status AS ENUM ('new', 'contacted', 'in_progress', 'quoted', 'closed', 'rejected')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create enum for lead priority\nCREATE TYPE public.lead_priority AS ENUM ('low', 'medium', 'high')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create contact_leads table\nCREATE TABLE public.contact_leads (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  name TEXT NOT NULL,\n  email TEXT NOT NULL,\n  company TEXT,\n  phone TEXT NOT NULL,\n  project_type TEXT NOT NULL,\n  annual_volume TEXT,\n  technical_requirements TEXT NOT NULL,\n  message TEXT,\n  status lead_status NOT NULL DEFAULT 'new',\n  priority lead_priority NOT NULL DEFAULT 'medium',\n  admin_notes TEXT,\n  assigned_to UUID REFERENCES public.admin_users(user_id) ON DELETE SET NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.contact_leads ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS Policies\nCREATE POLICY \"Admins can view all leads\"\n  ON public.contact_leads\n  FOR SELECT\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can update leads\"\n  ON public.contact_leads\n  FOR UPDATE\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can delete leads\"\n  ON public.contact_leads\n  FOR DELETE\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Public can insert leads\"\n  ON public.contact_leads\n  FOR INSERT\n  WITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION public.update_contact_leads_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create trigger for automatic timestamp updates\nCREATE TRIGGER update_contact_leads_updated_at\n  BEFORE UPDATE ON public.contact_leads\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_contact_leads_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create index for faster queries\nCREATE INDEX idx_contact_leads_status ON public.contact_leads(status)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_contact_leads_created_at ON public.contact_leads(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_contact_leads_email ON public.contact_leads(email)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115040403"},{"text":"6b4ad4c8-537f-4d3f-99f9-5147d1a8d562"},{"binary":"0000000100000000000000190000000d00000001000000892d2d2043726561746520656e756d20666f72206c656164207374617475730a4352454154452054595045207075626c69632e6c6561645f73746174757320415320454e554d2028276e6577272c2027636f6e746163746564272c2027696e5f70726f6772657373272c202771756f746564272c2027636c6f736564272c202772656a65637465642729000000632d2d2043726561746520656e756d20666f72206c656164207072696f726974790a4352454154452054595045207075626c69632e6c6561645f7072696f7269747920415320454e554d2028276c6f77272c20276d656469756d272c20276869676827290000027b2d2d2043726561746520636f6e746163745f6c65616473207461626c650a435245415445205441424c45207075626c69632e636f6e746163745f6c6561647320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a20206e616d652054455854204e4f54204e554c4c2c0a2020656d61696c2054455854204e4f54204e554c4c2c0a2020636f6d70616e7920544558542c0a202070686f6e652054455854204e4f54204e554c4c2c0a202070726f6a6563745f747970652054455854204e4f54204e554c4c2c0a2020616e6e75616c5f766f6c756d6520544558542c0a2020746563686e6963616c5f726571756972656d656e74732054455854204e4f54204e554c4c2c0a20206d65737361676520544558542c0a2020737461747573206c6561645f737461747573204e4f54204e554c4c2044454641554c5420276e6577272c0a20207072696f72697479206c6561645f7072696f72697479204e4f54204e554c4c2044454641554c5420276d656469756d272c0a202061646d696e5f6e6f74657320544558542c0a202061737369676e65645f746f2055554944205245464552454e434553207075626c69632e61646d696e5f757365727328757365725f696429204f4e2044454c45544520534554204e554c4c2c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000000482d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e636f6e746163745f6c6561647320454e41424c4520524f57204c4556454c2053454355524954590000008f2d2d20524c5320506f6c69636965730a43524541544520504f4c494359202241646d696e732063616e207669657720616c6c206c65616473220a20204f4e207075626c69632e636f6e746163745f6c656164730a2020464f522053454c4543540a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e2729290000007d43524541544520504f4c494359202241646d696e732063616e20757064617465206c65616473220a20204f4e207075626c69632e636f6e746163745f6c656164730a2020464f52205550444154450a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e2729290000007d43524541544520504f4c494359202241646d696e732063616e2064656c657465206c65616473220a20204f4e207075626c69632e636f6e746163745f6c656164730a2020464f522044454c4554450a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e2729290000006243524541544520504f4c49435920225075626c69632063616e20696e73657274206c65616473220a20204f4e207075626c69632e636f6e746163745f6c656164730a2020464f5220494e534552540a20205749544820434845434b20287472756529000000fc2d2d204372656174652066756e6374696f6e20746f2075706461746520757064617465645f61742074696d657374616d700a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e7570646174655f636f6e746163745f6c656164735f757064617465645f617428290a52455455524e5320545249474745522041532024240a424547494e0a20204e45572e757064617465645f6174203d206e6f7728293b0a202052455455524e204e45573b0a454e443b0a2424204c414e475541474520706c706773716c20534543555249545920444546494e455220534554207365617263685f70617468203d207075626c6963000000d32d2d20437265617465207472696767657220666f72206175746f6d617469632074696d657374616d7020757064617465730a4352454154452054524947474552207570646174655f636f6e746163745f6c656164735f757064617465645f61740a20204245464f524520555044415445204f4e207075626c69632e636f6e746163745f6c656164730a2020464f52204541434820524f570a2020455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e746163745f6c656164735f757064617465645f61742829000000682d2d2043726561746520696e64657820666f722066617374657220717565726965730a43524541544520494e444558206964785f636f6e746163745f6c656164735f737461747573204f4e207075626c69632e636f6e746163745f6c6561647328737461747573290000005243524541544520494e444558206964785f636f6e746163745f6c656164735f637265617465645f6174204f4e207075626c69632e636f6e746163745f6c6561647328637265617465645f61742044455343290000004343524541544520494e444558206964785f636f6e746163745f6c656164735f656d61696c204f4e207075626c69632e636f6e746163745f6c6561647328656d61696c29"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TYPE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TYPE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115174725_5b59bbf7-d7d2-469e-a5e7-563f85d4d686.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create ENUM for project type options\nCREATE TYPE project_type_option AS ENUM (\n  'dental_implants',\n  'orthopedic_implants', \n  'spinal_implants',\n  'veterinary_implants',\n  'surgical_instruments',\n  'micro_precision_parts',\n  'custom_tooling',\n  'medical_devices',\n  'measurement_tools',\n  'other_medical'\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add new column for array of project types\nALTER TABLE contact_leads \nADD COLUMN project_types project_type_option[] DEFAULT ARRAY[]::project_type_option[]","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Migrate existing data from project_type to project_types\nUPDATE contact_leads \nSET project_types = ARRAY['other_medical']::project_type_option[]\nWHERE project_type IS NOT NULL AND project_type != ''","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create index for better query performance on array column\nCREATE INDEX idx_contact_leads_project_types ON contact_leads USING GIN (project_types)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create view for detailed lead analytics\nCREATE OR REPLACE VIEW lead_analytics_detailed AS\nSELECT \n  l.id,\n  l.name,\n  l.email,\n  l.company,\n  l.phone,\n  l.project_types,\n  l.annual_volume,\n  l.status,\n  l.priority,\n  l.created_at,\n  l.updated_at,\n  DATE(l.created_at) as lead_date,\n  CASE \n    WHEN l.created_at \u003e= NOW() - INTERVAL '24 hours' THEN 'today'\n    WHEN l.created_at \u003e= NOW() - INTERVAL '7 days' THEN 'this_week'\n    WHEN l.created_at \u003e= NOW() - INTERVAL '30 days' THEN 'this_month'\n    ELSE 'older'\n  END as time_bucket,\n  CASE \n    WHEN l.status IN ('closed') THEN true\n    ELSE false\n  END as is_converted\nFROM contact_leads l","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create view for project type distribution\nCREATE OR REPLACE VIEW project_type_distribution AS\nSELECT \n  pt as project_type,\n  COUNT(*) as count,\n  COUNT(*) FILTER (WHERE status = 'closed') as converted_count,\n  ROUND(\n    (COUNT(*) FILTER (WHERE status = 'closed')::numeric / \n     NULLIF(COUNT(*), 0) * 100), \n    1\n  ) as conversion_rate\nFROM contact_leads\nCROSS JOIN UNNEST(project_types) as pt\nGROUP BY pt\nORDER BY count DESC","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create view for lead metrics by time period\nCREATE OR REPLACE VIEW lead_metrics_by_period AS\nSELECT \n  DATE_TRUNC('day', created_at) as period,\n  COUNT(*) as total_leads,\n  COUNT(*) FILTER (WHERE status = 'new') as new_leads,\n  COUNT(*) FILTER (WHERE status IN ('contacted', 'in_progress', 'quoted')) as active_leads,\n  COUNT(*) FILTER (WHERE status = 'closed') as closed_leads,\n  COUNT(*) FILTER (WHERE status = 'rejected') as rejected_leads,\n  ROUND(\n    (COUNT(*) FILTER (WHERE status = 'closed')::numeric / \n     NULLIF(COUNT(*), 0) * 100), \n    1\n  ) as conversion_rate\nFROM contact_leads\nGROUP BY DATE_TRUNC('day', created_at)\nORDER BY period DESC","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Grant permissions for views\nGRANT SELECT ON lead_analytics_detailed TO authenticated","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"GRANT SELECT ON project_type_distribution TO authenticated","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"GRANT SELECT ON lead_metrics_by_period TO authenticated","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115174725"},{"text":"5b59bbf7-d7d2-469e-a5e7-563f85d4d686"},{"binary":"0000000100000000000000190000000a00000001000001372d2d2043726561746520454e554d20666f722070726f6a6563742074797065206f7074696f6e730a43524541544520545950452070726f6a6563745f747970655f6f7074696f6e20415320454e554d20280a20202764656e74616c5f696d706c616e7473272c0a2020276f7274686f70656469635f696d706c616e7473272c200a2020277370696e616c5f696d706c616e7473272c0a2020277665746572696e6172795f696d706c616e7473272c0a202027737572676963616c5f696e737472756d656e7473272c0a2020276d6963726f5f707265636973696f6e5f7061727473272c0a202027637573746f6d5f746f6f6c696e67272c0a2020276d65646963616c5f64657669636573272c0a2020276d6561737572656d656e745f746f6f6c73272c0a2020276f746865725f6d65646963616c270a290000009d2d2d20416464206e657720636f6c756d6e20666f72206172726179206f662070726f6a6563742074797065730a414c544552205441424c4520636f6e746163745f6c65616473200a41444420434f4c554d4e2070726f6a6563745f74797065732070726f6a6563745f747970655f6f7074696f6e5b5d2044454641554c542041525241595b5d3a3a70726f6a6563745f747970655f6f7074696f6e5b5d000000c92d2d204d696772617465206578697374696e6720646174612066726f6d2070726f6a6563745f7479706520746f2070726f6a6563745f74797065730a55504441544520636f6e746163745f6c65616473200a5345542070726f6a6563745f7479706573203d2041525241595b276f746865725f6d65646963616c275d3a3a70726f6a6563745f747970655f6f7074696f6e5b5d0a57484552452070726f6a6563745f74797065204953204e4f54204e554c4c20414e442070726f6a6563745f7479706520213d202727000000942d2d2043726561746520696e64657820666f722062657474657220717565727920706572666f726d616e6365206f6e20617272617920636f6c756d6e0a43524541544520494e444558206964785f636f6e746163745f6c656164735f70726f6a6563745f7479706573204f4e20636f6e746163745f6c65616473205553494e472047494e202870726f6a6563745f747970657329000002832d2d20437265617465207669657720666f722064657461696c6564206c65616420616e616c79746963730a435245415445204f52205245504c4143452056494557206c6561645f616e616c79746963735f64657461696c65642041530a53454c454354200a20206c2e69642c0a20206c2e6e616d652c0a20206c2e656d61696c2c0a20206c2e636f6d70616e792c0a20206c2e70686f6e652c0a20206c2e70726f6a6563745f74797065732c0a20206c2e616e6e75616c5f766f6c756d652c0a20206c2e7374617475732c0a20206c2e7072696f726974792c0a20206c2e637265617465645f61742c0a20206c2e757064617465645f61742c0a202044415445286c2e637265617465645f617429206173206c6561645f646174652c0a202043415345200a202020205748454e206c2e637265617465645f6174203e3d204e4f572829202d20494e54455256414c2027323420686f75727327205448454e2027746f646179270a202020205748454e206c2e637265617465645f6174203e3d204e4f572829202d20494e54455256414c202737206461797327205448454e2027746869735f7765656b270a202020205748454e206c2e637265617465645f6174203e3d204e4f572829202d20494e54455256414c20273330206461797327205448454e2027746869735f6d6f6e7468270a20202020454c534520276f6c646572270a2020454e442061732074696d655f6275636b65742c0a202043415345200a202020205748454e206c2e73746174757320494e202827636c6f7365642729205448454e20747275650a20202020454c53452066616c73650a2020454e442061732069735f636f6e7665727465640a46524f4d20636f6e746163745f6c65616473206c000001b02d2d20437265617465207669657720666f722070726f6a656374207479706520646973747269627574696f6e0a435245415445204f52205245504c41434520564945572070726f6a6563745f747970655f646973747269627574696f6e2041530a53454c454354200a202070742061732070726f6a6563745f747970652c0a2020434f554e54282a2920617320636f756e742c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f736564272920617320636f6e7665727465645f636f756e742c0a2020524f554e44280a2020202028434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f73656427293a3a6e756d65726963202f200a20202020204e554c4c494628434f554e54282a292c203029202a20313030292c200a20202020310a20202920617320636f6e76657273696f6e5f726174650a46524f4d20636f6e746163745f6c656164730a43524f5353204a4f494e20554e4e4553542870726f6a6563745f7479706573292061732070740a47524f55502042592070740a4f5244455220425920636f756e742044455343000002902d2d20437265617465207669657720666f72206c656164206d6574726963732062792074696d6520706572696f640a435245415445204f52205245504c4143452056494557206c6561645f6d6574726963735f62795f706572696f642041530a53454c454354200a2020444154455f5452554e432827646179272c20637265617465645f61742920617320706572696f642c0a2020434f554e54282a2920617320746f74616c5f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d20276e65772729206173206e65775f6c656164732c0a2020434f554e54282a292046494c544552202857484552452073746174757320494e202827636f6e746163746564272c2027696e5f70726f6772657373272c202771756f746564272929206173206163746976655f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f736564272920617320636c6f7365645f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d202772656a656374656427292061732072656a65637465645f6c656164732c0a2020524f554e44280a2020202028434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f73656427293a3a6e756d65726963202f200a20202020204e554c4c494628434f554e54282a292c203029202a20313030292c200a20202020310a20202920617320636f6e76657273696f6e5f726174650a46524f4d20636f6e746163745f6c656164730a47524f555020425920444154455f5452554e432827646179272c20637265617465645f6174290a4f5244455220425920706572696f642044455343000000572d2d204772616e74207065726d697373696f6e7320666f722076696577730a4752414e542053454c454354204f4e206c6561645f616e616c79746963735f64657461696c656420544f2061757468656e746963617465640000003a4752414e542053454c454354204f4e2070726f6a6563745f747970655f646973747269627574696f6e20544f2061757468656e74696361746564000000374752414e542053454c454354204f4e206c6561645f6d6574726963735f62795f706572696f6420544f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TYPE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115195543_b7cccc8c-accc-47c4-ad2c-07477080d47a.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create table for caching company research data\nCREATE TABLE company_research (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  domain TEXT NOT NULL UNIQUE,\n  company_name TEXT,\n  website_summary TEXT,\n  linkedin_info TEXT,\n  industry TEXT,\n  key_products TEXT[],\n  recent_news TEXT,\n  researched_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  expires_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() + INTERVAL '30 days',\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create index for domain lookup\nCREATE INDEX idx_company_research_domain ON company_research(domain)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_company_research_expires ON company_research(expires_at)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create table for storing AI response suggestions\nCREATE TABLE ai_response_suggestions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID REFERENCES contact_leads(id) ON DELETE CASCADE,\n  subject_line TEXT NOT NULL,\n  email_body TEXT NOT NULL,\n  key_points TEXT[],\n  follow_up_date DATE,\n  priority_level TEXT CHECK (priority_level IN ('low', 'medium', 'high')),\n  company_research_id UUID REFERENCES company_research(id),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create indexes for better query performance\nCREATE INDEX idx_ai_suggestions_lead ON ai_response_suggestions(lead_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_ai_suggestions_created ON ai_response_suggestions(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS on both tables\nALTER TABLE company_research ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE ai_response_suggestions ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS policies for company_research\nCREATE POLICY \"Admins can view company research\" \n  ON company_research FOR SELECT \n  USING (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can insert company research\" \n  ON company_research FOR INSERT \n  WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can update company research\" \n  ON company_research FOR UPDATE \n  USING (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS policies for ai_response_suggestions\nCREATE POLICY \"Admins can view AI suggestions\" \n  ON ai_response_suggestions FOR SELECT \n  USING (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can insert AI suggestions\" \n  ON ai_response_suggestions FOR INSERT \n  WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can update AI suggestions\" \n  ON ai_response_suggestions FOR UPDATE \n  USING (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115195543"},{"text":"b7cccc8c-accc-47c4-ad2c-07477080d47a"},{"binary":"0000000100000000000000190000000e00000001000001d82d2d20437265617465207461626c6520666f722063616368696e6720636f6d70616e7920726573656172636820646174610a435245415445205441424c4520636f6d70616e795f726573656172636820280a202069642055554944205052494d415259204b45592044454641554c542067656e5f72616e646f6d5f7575696428292c0a2020646f6d61696e2054455854204e4f54204e554c4c20554e495155452c0a2020636f6d70616e795f6e616d6520544558542c0a2020776562736974655f73756d6d61727920544558542c0a20206c696e6b6564696e5f696e666f20544558542c0a2020696e64757374727920544558542c0a20206b65795f70726f647563747320544558545b5d2c0a2020726563656e745f6e65777320544558542c0a2020726573656172636865645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54204e4f5728292c0a2020657870697265735f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54204e4f572829202b20494e54455256414c202733302064617973272c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54204e4f5728290a29000000662d2d2043726561746520696e64657820666f7220646f6d61696e206c6f6f6b75700a43524541544520494e444558206964785f636f6d70616e795f72657365617263685f646f6d61696e204f4e20636f6d70616e795f726573656172636828646f6d61696e290000004943524541544520494e444558206964785f636f6d70616e795f72657365617263685f65787069726573204f4e20636f6d70616e795f726573656172636828657870697265735f617429000001ed2d2d20437265617465207461626c6520666f722073746f72696e6720414920726573706f6e73652073756767657374696f6e730a435245415445205441424c452061695f726573706f6e73655f73756767657374696f6e7320280a202069642055554944205052494d415259204b45592044454641554c542067656e5f72616e646f6d5f7575696428292c0a20206c6561645f69642055554944205245464552454e43455320636f6e746163745f6c6561647328696429204f4e2044454c45544520434153434144452c0a20207375626a6563745f6c696e652054455854204e4f54204e554c4c2c0a2020656d61696c5f626f64792054455854204e4f54204e554c4c2c0a20206b65795f706f696e747320544558545b5d2c0a2020666f6c6c6f775f75705f6461746520444154452c0a20207072696f726974795f6c6576656c205445585420434845434b20287072696f726974795f6c6576656c20494e2028276c6f77272c20276d656469756d272c2027686967682729292c0a2020636f6d70616e795f72657365617263685f69642055554944205245464552454e43455320636f6d70616e795f7265736561726368286964292c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54204e4f5728290a29000000772d2d2043726561746520696e646578657320666f722062657474657220717565727920706572666f726d616e63650a43524541544520494e444558206964785f61695f73756767657374696f6e735f6c656164204f4e2061695f726573706f6e73655f73756767657374696f6e73286c6561645f6964290000005343524541544520494e444558206964785f61695f73756767657374696f6e735f63726561746564204f4e2061695f726573706f6e73655f73756767657374696f6e7328637265617465645f6174204445534329000000532d2d20456e61626c6520524c53206f6e20626f7468207461626c65730a414c544552205441424c4520636f6d70616e795f726573656172636820454e41424c4520524f57204c4556454c2053454355524954590000003d414c544552205441424c452061695f726573706f6e73655f73756767657374696f6e7320454e41424c4520524f57204c4556454c205345435552495459000000aa2d2d20524c5320706f6c696369657320666f7220636f6d70616e795f72657365617263680a43524541544520504f4c494359202241646d696e732063616e207669657720636f6d70616e7920726573656172636822200a20204f4e20636f6d70616e795f726573656172636820464f522053454c454354200a20205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000008c43524541544520504f4c494359202241646d696e732063616e20696e7365727420636f6d70616e7920726573656172636822200a20204f4e20636f6d70616e795f726573656172636820464f5220494e53455254200a20205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000008743524541544520504f4c494359202241646d696e732063616e2075706461746520636f6d70616e7920726573656172636822200a20204f4e20636f6d70616e795f726573656172636820464f5220555044415445200a20205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929000000b62d2d20524c5320706f6c696369657320666f722061695f726573706f6e73655f73756767657374696f6e730a43524541544520504f4c494359202241646d696e732063616e20766965772041492073756767657374696f6e7322200a20204f4e2061695f726573706f6e73655f73756767657374696f6e7320464f522053454c454354200a20205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000009143524541544520504f4c494359202241646d696e732063616e20696e736572742041492073756767657374696f6e7322200a20204f4e2061695f726573706f6e73655f73756767657374696f6e7320464f5220494e53455254200a20205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000008c43524541544520504f4c494359202241646d696e732063616e207570646174652041492073756767657374696f6e7322200a20204f4e2061695f726573706f6e73655f73756767657374696f6e7320464f5220555044415445200a20205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115202311_cf7690da-82cc-4b3a-95a1-3d28d39f11df.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create linkedin_carousels table for storing generated carousels\nCREATE TABLE public.linkedin_carousels (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  admin_user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  topic TEXT NOT NULL,\n  target_audience TEXT NOT NULL,\n  pain_point TEXT,\n  desired_outcome TEXT,\n  proof_points TEXT,\n  cta_action TEXT,\n  slides JSONB NOT NULL,\n  caption TEXT NOT NULL,\n  performance_metrics JSONB DEFAULT '{}',\n  is_favorite BOOLEAN DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL,\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.linkedin_carousels ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Admins can view all carousels\nCREATE POLICY \"Admins can view all carousels\"\n  ON public.linkedin_carousels\n  FOR SELECT\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Admins can insert carousels\nCREATE POLICY \"Admins can insert carousels\"\n  ON public.linkedin_carousels\n  FOR INSERT\n  WITH CHECK (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Admins can update carousels\nCREATE POLICY \"Admins can update carousels\"\n  ON public.linkedin_carousels\n  FOR UPDATE\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Admins can delete carousels\nCREATE POLICY \"Admins can delete carousels\"\n  ON public.linkedin_carousels\n  FOR DELETE\n  USING (public.has_role(auth.uid(), 'admin'))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create trigger for updated_at\nCREATE TRIGGER update_linkedin_carousels_updated_at\n  BEFORE UPDATE ON public.linkedin_carousels\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_contact_leads_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115202311"},{"text":"cf7690da-82cc-4b3a-95a1-3d28d39f11df"},{"binary":"0000000100000000000000190000000700000001000002702d2d20437265617465206c696e6b6564696e5f6361726f7573656c73207461626c6520666f722073746f72696e672067656e657261746564206361726f7573656c730a435245415445205441424c45207075626c69632e6c696e6b6564696e5f6361726f7573656c7320280a202069642055554944205052494d415259204b45592044454641554c542067656e5f72616e646f6d5f7575696428292c0a202061646d696e5f757365725f69642055554944204e4f54204e554c4c205245464552454e43455320617574682e757365727328696429204f4e2044454c45544520434153434144452c0a2020746f7069632054455854204e4f54204e554c4c2c0a20207461726765745f61756469656e63652054455854204e4f54204e554c4c2c0a20207061696e5f706f696e7420544558542c0a2020646573697265645f6f7574636f6d6520544558542c0a202070726f6f665f706f696e747320544558542c0a20206374615f616374696f6e20544558542c0a2020736c69646573204a534f4e42204e4f54204e554c4c2c0a202063617074696f6e2054455854204e4f54204e554c4c2c0a2020706572666f726d616e63655f6d657472696373204a534f4e422044454641554c5420277b7d272c0a202069735f6661766f7269746520424f4f4c45414e2044454641554c542066616c73652c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54206e6f772829204e4f54204e554c4c2c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e452044454641554c54206e6f772829204e4f54204e554c4c0a290000004d2d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e6c696e6b6564696e5f6361726f7573656c7320454e41424c4520524f57204c4556454c205345435552495459000000a92d2d2041646d696e732063616e207669657720616c6c206361726f7573656c730a43524541544520504f4c494359202241646d696e732063616e207669657720616c6c206361726f7573656c73220a20204f4e207075626c69632e6c696e6b6564696e5f6361726f7573656c730a2020464f522053454c4543540a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e272929000000aa2d2d2041646d696e732063616e20696e73657274206361726f7573656c730a43524541544520504f4c494359202241646d696e732063616e20696e73657274206361726f7573656c73220a20204f4e207075626c69632e6c696e6b6564696e5f6361726f7573656c730a2020464f5220494e534552540a20205749544820434845434b20287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e272929000000a52d2d2041646d696e732063616e20757064617465206361726f7573656c730a43524541544520504f4c494359202241646d696e732063616e20757064617465206361726f7573656c73220a20204f4e207075626c69632e6c696e6b6564696e5f6361726f7573656c730a2020464f52205550444154450a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e272929000000a52d2d2041646d696e732063616e2064656c657465206361726f7573656c730a43524541544520504f4c494359202241646d696e732063616e2064656c657465206361726f7573656c73220a20204f4e207075626c69632e6c696e6b6564696e5f6361726f7573656c730a2020464f522044454c4554450a20205553494e4720287075626c69632e6861735f726f6c6528617574682e75696428292c202761646d696e272929000000cc2d2d20437265617465207472696767657220666f7220757064617465645f61740a4352454154452054524947474552207570646174655f6c696e6b6564696e5f6361726f7573656c735f757064617465645f61740a20204245464f524520555044415445204f4e207075626c69632e6c696e6b6564696e5f6361726f7573656c730a2020464f52204541434820524f570a2020455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e746163745f6c656164735f757064617465645f61742829"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251115214919_49bbbee2-634a-4c20-9b15-316d2d062950.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add image generation support to linkedin_carousels table\nALTER TABLE linkedin_carousels \nADD COLUMN IF NOT EXISTS format TEXT DEFAULT 'carousel' CHECK (format IN ('carousel', 'single-image')),\nADD COLUMN IF NOT EXISTS image_urls JSONB DEFAULT '[]'::jsonb,\nADD COLUMN IF NOT EXISTS generation_settings JSONB DEFAULT '{}'::jsonb","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add index for format filtering\nCREATE INDEX IF NOT EXISTS idx_linkedin_carousels_format ON linkedin_carousels(format)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add index for created_at for sorting history\nCREATE INDEX IF NOT EXISTS idx_linkedin_carousels_created_at ON linkedin_carousels(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251115214919"},{"text":"49bbbee2-634a-4c20-9b15-316d2d062950"},{"binary":"0000000100000000000000190000000300000001000001492d2d2041646420696d6167652067656e65726174696f6e20737570706f727420746f206c696e6b6564696e5f6361726f7573656c73207461626c650a414c544552205441424c45206c696e6b6564696e5f6361726f7573656c73200a41444420434f4c554d4e204946204e4f542045584953545320666f726d617420544558542044454641554c5420276361726f7573656c2720434845434b2028666f726d617420494e2028276361726f7573656c272c202773696e676c652d696d6167652729292c0a41444420434f4c554d4e204946204e4f542045584953545320696d6167655f75726c73204a534f4e422044454641554c5420275b5d273a3a6a736f6e622c0a41444420434f4c554d4e204946204e4f54204558495354532067656e65726174696f6e5f73657474696e6773204a534f4e422044454641554c5420277b7d273a3a6a736f6e62000000782d2d2041646420696e64657820666f7220666f726d61742066696c746572696e670a43524541544520494e444558204946204e4f5420455849535453206964785f6c696e6b6564696e5f6361726f7573656c735f666f726d6174204f4e206c696e6b6564696e5f6361726f7573656c7328666f726d617429000000932d2d2041646420696e64657820666f7220637265617465645f617420666f7220736f7274696e6720686973746f72790a43524541544520494e444558204946204e4f5420455849535453206964785f6c696e6b6564696e5f6361726f7573656c735f637265617465645f6174204f4e206c696e6b6564696e5f6361726f7573656c7328637265617465645f6174204445534329"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251116154422_c05775e0-1821-4325-9989-774d5fb02fa0.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create public storage bucket for processed product images\nINSERT INTO storage.buckets (id, name, public)\nVALUES ('processed-products', 'processed-products', true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create table to store metadata of processed images\nCREATE TABLE public.processed_product_images (\n  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n  created_at TIMESTAMPTZ DEFAULT now() NOT NULL,\n  updated_at TIMESTAMPTZ DEFAULT now() NOT NULL,\n  \n  -- Image URLs\n  original_url TEXT NOT NULL,\n  enhanced_url TEXT NOT NULL,\n  \n  -- AI analysis metadata\n  name TEXT NOT NULL,\n  description TEXT,\n  category TEXT NOT NULL,\n  brand TEXT,\n  model TEXT,\n  \n  -- Additional metadata\n  original_filename TEXT NOT NULL,\n  file_size INTEGER,\n  custom_prompt TEXT,\n  \n  -- Who processed it (admin)\n  processed_by UUID REFERENCES auth.users(id),\n  \n  -- Flags\n  is_featured BOOLEAN DEFAULT false,\n  is_visible BOOLEAN DEFAULT true\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Indexes for performance\nCREATE INDEX idx_processed_images_category ON public.processed_product_images(category)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_processed_images_brand ON public.processed_product_images(brand)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_processed_images_created ON public.processed_product_images(created_at DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Trigger to auto-update updated_at\nCREATE TRIGGER update_processed_images_updated_at\n  BEFORE UPDATE ON public.processed_product_images\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_contact_leads_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.processed_product_images ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS Policies for table\nCREATE POLICY \"Admins have full access to processed images\"\n  ON public.processed_product_images\n  FOR ALL\n  USING (has_role(auth.uid(), 'admin'::app_role))\n  WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Public can view visible images\"\n  ON public.processed_product_images\n  FOR SELECT\n  USING (is_visible = true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Storage policies\nCREATE POLICY \"Admins can upload processed images\"\n  ON storage.objects\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    bucket_id = 'processed-products' \n    AND has_role(auth.uid(), 'admin'::app_role)\n  )","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can update processed images\"\n  ON storage.objects\n  FOR UPDATE\n  TO authenticated\n  USING (\n    bucket_id = 'processed-products' \n    AND has_role(auth.uid(), 'admin'::app_role)\n  )","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can delete processed images\"\n  ON storage.objects\n  FOR DELETE\n  TO authenticated\n  USING (\n    bucket_id = 'processed-products' \n    AND has_role(auth.uid(), 'admin'::app_role)\n  )","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Public can view processed images\"\n  ON storage.objects\n  FOR SELECT\n  USING (bucket_id = 'processed-products')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251116154422"},{"text":"c05775e0-1821-4325-9989-774d5fb02fa0"},{"binary":"0000000100000000000000190000000d00000001000000a52d2d20437265617465207075626c69632073746f72616765206275636b657420666f722070726f6365737365642070726f6475637420696d616765730a494e5345525420494e544f2073746f726167652e6275636b657473202869642c206e616d652c207075626c6963290a56414c55455320282770726f6365737365642d70726f6475637473272c202770726f6365737365642d70726f6475637473272c207472756529000002d42d2d20437265617465207461626c6520746f2073746f7265206d65746164617461206f662070726f63657373656420696d616765730a435245415445205441424c45207075626c69632e70726f6365737365645f70726f647563745f696d6167657320280a2020696420555549442044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a2020637265617465645f61742054494d455354414d50545a2044454641554c54206e6f772829204e4f54204e554c4c2c0a2020757064617465645f61742054494d455354414d50545a2044454641554c54206e6f772829204e4f54204e554c4c2c0a20200a20202d2d20496d6167652055524c730a20206f726967696e616c5f75726c2054455854204e4f54204e554c4c2c0a2020656e68616e6365645f75726c2054455854204e4f54204e554c4c2c0a20200a20202d2d20414920616e616c79736973206d657461646174610a20206e616d652054455854204e4f54204e554c4c2c0a20206465736372697074696f6e20544558542c0a202063617465676f72792054455854204e4f54204e554c4c2c0a20206272616e6420544558542c0a20206d6f64656c20544558542c0a20200a20202d2d204164646974696f6e616c206d657461646174610a20206f726967696e616c5f66696c656e616d652054455854204e4f54204e554c4c2c0a202066696c655f73697a6520494e54454745522c0a2020637573746f6d5f70726f6d707420544558542c0a20200a20202d2d2057686f2070726f636573736564206974202861646d696e290a202070726f6365737365645f62792055554944205245464552454e43455320617574682e7573657273286964292c0a20200a20202d2d20466c6167730a202069735f666561747572656420424f4f4c45414e2044454641554c542066616c73652c0a202069735f76697369626c6520424f4f4c45414e2044454641554c5420747275650a29000000722d2d20496e646578657320666f7220706572666f726d616e63650a43524541544520494e444558206964785f70726f6365737365645f696d616765735f63617465676f7279204f4e207075626c69632e70726f6365737365645f70726f647563745f696d616765732863617465676f7279290000005143524541544520494e444558206964785f70726f6365737365645f696d616765735f6272616e64204f4e207075626c69632e70726f6365737365645f70726f647563745f696d61676573286272616e64290000005d43524541544520494e444558206964785f70726f6365737365645f696d616765735f63726561746564204f4e207075626c69632e70726f6365737365645f70726f647563745f696d6167657328637265617465645f6174204445534329000000d42d2d205472696767657220746f206175746f2d75706461746520757064617465645f61740a4352454154452054524947474552207570646174655f70726f6365737365645f696d616765735f757064617465645f61740a20204245464f524520555044415445204f4e207075626c69632e70726f6365737365645f70726f647563745f696d616765730a2020464f52204541434820524f570a2020455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e746163745f6c656164735f757064617465645f61742829000000532d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e70726f6365737365645f70726f647563745f696d6167657320454e41424c4520524f57204c4556454c205345435552495459000000ed2d2d20524c5320506f6c696369657320666f72207461626c650a43524541544520504f4c494359202241646d696e7320686176652066756c6c2061636365737320746f2070726f63657373656420696d61676573220a20204f4e207075626c69632e70726f6365737365645f70726f647563745f696d616765730a2020464f5220414c4c0a20205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290a20205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000007c43524541544520504f4c49435920225075626c69632063616e20766965772076697369626c6520696d61676573220a20204f4e207075626c69632e70726f6365737365645f70726f647563745f696d616765730a2020464f522053454c4543540a20205553494e47202869735f76697369626c65203d207472756529000000e42d2d2053746f7261676520706f6c69636965730a43524541544520504f4c494359202241646d696e732063616e2075706c6f61642070726f63657373656420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f5220494e534552540a2020544f2061757468656e746963617465640a20205749544820434845434b20280a202020206275636b65745f6964203d202770726f6365737365642d70726f647563747327200a20202020414e44206861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c65290a202029000000cb43524541544520504f4c494359202241646d696e732063616e207570646174652070726f63657373656420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f52205550444154450a2020544f2061757468656e746963617465640a20205553494e4720280a202020206275636b65745f6964203d202770726f6365737365642d70726f647563747327200a20202020414e44206861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c65290a202029000000cb43524541544520504f4c494359202241646d696e732063616e2064656c6574652070726f63657373656420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f522044454c4554450a2020544f2061757468656e746963617465640a20205553494e4720280a202020206275636b65745f6964203d202770726f6365737365642d70726f647563747327200a20202020414e44206861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c65290a2020290000007d43524541544520504f4c49435920225075626c69632063616e20766965772070726f63657373656420696d61676573220a20204f4e2073746f726167652e6f626a656374730a2020464f522053454c4543540a20205553494e4720286275636b65745f6964203d202770726f6365737365642d70726f64756374732729"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251116160235_b98f2580-3d3c-46d8-8ae3-d3e327e95542.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add lead scoring columns to contact_leads table\nALTER TABLE contact_leads \nADD COLUMN IF NOT EXISTS lead_score INTEGER DEFAULT 0,\nADD COLUMN IF NOT EXISTS score_breakdown JSONB DEFAULT '{}'::jsonb","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create index for faster sorting by score\nCREATE INDEX IF NOT EXISTS idx_contact_leads_lead_score ON contact_leads(lead_score DESC)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Add comment for documentation\nCOMMENT ON COLUMN contact_leads.lead_score IS 'Automated lead quality score from 0-100 based on multiple factors'","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"COMMENT ON COLUMN contact_leads.score_breakdown IS 'Detailed breakdown of how the lead score was calculated for debugging'","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251116160235"},{"text":"b98f2580-3d3c-46d8-8ae3-d3e327e95542"},{"binary":"0000000100000000000000190000000400000001000000c72d2d20416464206c6561642073636f72696e6720636f6c756d6e7320746f20636f6e746163745f6c65616473207461626c650a414c544552205441424c4520636f6e746163745f6c65616473200a41444420434f4c554d4e204946204e4f5420455849535453206c6561645f73636f726520494e54454745522044454641554c5420302c0a41444420434f4c554d4e204946204e4f54204558495354532073636f72655f627265616b646f776e204a534f4e422044454641554c5420277b7d273a3a6a736f6e62000000852d2d2043726561746520696e64657820666f722066617374657220736f7274696e672062792073636f72650a43524541544520494e444558204946204e4f5420455849535453206964785f636f6e746163745f6c656164735f6c6561645f73636f7265204f4e20636f6e746163745f6c65616473286c6561645f73636f7265204445534329000000922d2d2041646420636f6d6d656e7420666f7220646f63756d656e746174696f6e0a434f4d4d454e54204f4e20434f4c554d4e20636f6e746163745f6c656164732e6c6561645f73636f726520495320274175746f6d61746564206c656164207175616c6974792073636f72652066726f6d20302d313030206261736564206f6e206d756c7469706c6520666163746f7273270000007a434f4d4d454e54204f4e20434f4c554d4e20636f6e746163745f6c656164732e73636f72655f627265616b646f776e204953202744657461696c656420627265616b646f776e206f6620686f7720746865206c6561642073636f7265207761732063616c63756c6174656420666f7220646562756767696e6727"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251204042356_ffda93ec-2a1a-4a30-9894-4cb31752c064.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Convert security definer views to security invoker\n-- This ensures views respect RLS policies of underlying tables\n\n-- Drop and recreate lead_analytics_detailed as security invoker\nDROP VIEW IF EXISTS public.lead_analytics_detailed","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE VIEW public.lead_analytics_detailed \nWITH (security_invoker = true)\nAS\nSELECT \n  id,\n  name,\n  email,\n  company,\n  phone,\n  annual_volume,\n  priority,\n  status,\n  project_types,\n  created_at,\n  updated_at,\n  DATE(created_at) as lead_date,\n  TO_CHAR(DATE_TRUNC('week', created_at), 'YYYY-WW') as time_bucket,\n  CASE WHEN status = 'closed' THEN true ELSE false END as is_converted\nFROM public.contact_leads","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Drop and recreate project_type_distribution as security invoker\nDROP VIEW IF EXISTS public.project_type_distribution","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE VIEW public.project_type_distribution\nWITH (security_invoker = true)\nAS\nSELECT \n  unnest(project_types) as project_type,\n  COUNT(*) as count,\n  COUNT(*) FILTER (WHERE status = 'closed') as converted_count,\n  ROUND(\n    COUNT(*) FILTER (WHERE status = 'closed')::numeric / NULLIF(COUNT(*)::numeric, 0) * 100, \n    2\n  ) as conversion_rate\nFROM public.contact_leads\nGROUP BY unnest(project_types)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Drop and recreate lead_metrics_by_period as security invoker\nDROP VIEW IF EXISTS public.lead_metrics_by_period","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE VIEW public.lead_metrics_by_period\nWITH (security_invoker = true)\nAS\nSELECT \n  DATE_TRUNC('week', created_at) as period,\n  COUNT(*) as total_leads,\n  COUNT(*) FILTER (WHERE status = 'new') as new_leads,\n  COUNT(*) FILTER (WHERE status IN ('contacted', 'in_progress', 'quoted')) as active_leads,\n  COUNT(*) FILTER (WHERE status = 'closed') as closed_leads,\n  COUNT(*) FILTER (WHERE status = 'rejected') as rejected_leads,\n  ROUND(\n    COUNT(*) FILTER (WHERE status = 'closed')::numeric / NULLIF(COUNT(*)::numeric, 0) * 100, \n    2\n  ) as conversion_rate\nFROM public.contact_leads\nGROUP BY DATE_TRUNC('week', created_at)\nORDER BY period DESC","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251204042356"},{"text":"ffda93ec-2a1a-4a30-9894-4cb31752c064"},{"binary":"0000000100000000000000190000000600000001000000ea2d2d20436f6e7665727420736563757269747920646566696e657220766965777320746f20736563757269747920696e766f6b65720a2d2d205468697320656e7375726573207669657773207265737065637420524c5320706f6c6963696573206f6620756e6465726c79696e67207461626c65730a0a2d2d2044726f7020616e64207265637265617465206c6561645f616e616c79746963735f64657461696c656420617320736563757269747920696e766f6b65720a44524f50205649455720494620455849535453207075626c69632e6c6561645f616e616c79746963735f64657461696c65640000019b4352454154452056494557207075626c69632e6c6561645f616e616c79746963735f64657461696c6564200a57495448202873656375726974795f696e766f6b6572203d2074727565290a41530a53454c454354200a202069642c0a20206e616d652c0a2020656d61696c2c0a2020636f6d70616e792c0a202070686f6e652c0a2020616e6e75616c5f766f6c756d652c0a20207072696f726974792c0a20207374617475732c0a202070726f6a6563745f74797065732c0a2020637265617465645f61742c0a2020757064617465645f61742c0a20204441544528637265617465645f617429206173206c6561645f646174652c0a2020544f5f4348415228444154455f5452554e4328277765656b272c20637265617465645f6174292c2027595959592d575727292061732074696d655f6275636b65742c0a202043415345205748454e20737461747573203d2027636c6f73656427205448454e207472756520454c53452066616c736520454e442061732069735f636f6e7665727465640a46524f4d207075626c69632e636f6e746163745f6c65616473000000772d2d2044726f7020616e642072656372656174652070726f6a6563745f747970655f646973747269627574696f6e20617320736563757269747920696e766f6b65720a44524f50205649455720494620455849535453207075626c69632e70726f6a6563745f747970655f646973747269627574696f6e000001914352454154452056494557207075626c69632e70726f6a6563745f747970655f646973747269627574696f6e0a57495448202873656375726974795f696e766f6b6572203d2074727565290a41530a53454c454354200a2020756e6e6573742870726f6a6563745f7479706573292061732070726f6a6563745f747970652c0a2020434f554e54282a2920617320636f756e742c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f736564272920617320636f6e7665727465645f636f756e742c0a2020524f554e44280a20202020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f73656427293a3a6e756d65726963202f204e554c4c494628434f554e54282a293a3a6e756d657269632c203029202a203130302c200a20202020320a20202920617320636f6e76657273696f6e5f726174650a46524f4d207075626c69632e636f6e746163745f6c656164730a47524f555020425920756e6e6573742870726f6a6563745f747970657329000000712d2d2044726f7020616e64207265637265617465206c6561645f6d6574726963735f62795f706572696f6420617320736563757269747920696e766f6b65720a44524f50205649455720494620455849535453207075626c69632e6c6561645f6d6574726963735f62795f706572696f64000002864352454154452056494557207075626c69632e6c6561645f6d6574726963735f62795f706572696f640a57495448202873656375726974795f696e766f6b6572203d2074727565290a41530a53454c454354200a2020444154455f5452554e4328277765656b272c20637265617465645f61742920617320706572696f642c0a2020434f554e54282a2920617320746f74616c5f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d20276e65772729206173206e65775f6c656164732c0a2020434f554e54282a292046494c544552202857484552452073746174757320494e202827636f6e746163746564272c2027696e5f70726f6772657373272c202771756f746564272929206173206163746976655f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f736564272920617320636c6f7365645f6c656164732c0a2020434f554e54282a292046494c5445522028574845524520737461747573203d202772656a656374656427292061732072656a65637465645f6c656164732c0a2020524f554e44280a20202020434f554e54282a292046494c5445522028574845524520737461747573203d2027636c6f73656427293a3a6e756d65726963202f204e554c4c494628434f554e54282a293a3a6e756d657269632c203029202a203130302c200a20202020320a20202920617320636f6e76657273696f6e5f726174650a46524f4d207075626c69632e636f6e746163745f6c656164730a47524f555020425920444154455f5452554e4328277765656b272c20637265617465645f6174290a4f5244455220425920706572696f642044455343"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251204192254_935951bc-56b1-4b58-af1e-d2aef3e23491.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create function to update timestamps for daily_tasks\nCREATE OR REPLACE FUNCTION public.update_daily_tasks_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create daily_tasks table\nCREATE TABLE public.daily_tasks (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  assigned_to UUID NOT NULL,\n  task_type TEXT NOT NULL,\n  title TEXT NOT NULL,\n  description TEXT,\n  lead_id UUID REFERENCES public.contact_leads(id) ON DELETE CASCADE,\n  priority TEXT NOT NULL DEFAULT 'medium',\n  status TEXT NOT NULL DEFAULT 'pending',\n  due_date DATE,\n  completed_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.daily_tasks ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create RLS policies\nCREATE POLICY \"Users can view their assigned tasks\"\nON public.daily_tasks\nFOR SELECT\nUSING (auth.uid() = assigned_to OR has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can insert tasks\"\nON public.daily_tasks\nFOR INSERT\nWITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Users can update their own tasks\"\nON public.daily_tasks\nFOR UPDATE\nUSING (auth.uid() = assigned_to OR has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can delete tasks\"\nON public.daily_tasks\nFOR DELETE\nUSING (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create trigger for updated_at\nCREATE TRIGGER update_daily_tasks_updated_at\nBEFORE UPDATE ON public.daily_tasks\nFOR EACH ROW\nEXECUTE FUNCTION public.update_daily_tasks_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create indexes\nCREATE INDEX idx_daily_tasks_assigned_to ON public.daily_tasks(assigned_to)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_daily_tasks_status ON public.daily_tasks(status)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_daily_tasks_due_date ON public.daily_tasks(due_date)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251204192254"},{"text":"935951bc-56b1-4b58-af1e-d2aef3e23491"},{"binary":"0000000100000000000000190000000b00000001000001002d2d204372656174652066756e6374696f6e20746f207570646174652074696d657374616d707320666f72206461696c795f7461736b730a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e7570646174655f6461696c795f7461736b735f757064617465645f617428290a52455455524e5320545249474745522041532024240a424547494e0a20204e45572e757064617465645f6174203d206e6f7728293b0a202052455455524e204e45573b0a454e443b0a2424204c414e475541474520706c706773716c20534543555249545920444546494e455220534554207365617263685f70617468203d207075626c69630000022c2d2d20437265617465206461696c795f7461736b73207461626c650a435245415445205441424c45207075626c69632e6461696c795f7461736b7320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202061737369676e65645f746f2055554944204e4f54204e554c4c2c0a20207461736b5f747970652054455854204e4f54204e554c4c2c0a20207469746c652054455854204e4f54204e554c4c2c0a20206465736372697074696f6e20544558542c0a20206c6561645f69642055554944205245464552454e434553207075626c69632e636f6e746163745f6c6561647328696429204f4e2044454c45544520434153434144452c0a20207072696f726974792054455854204e4f54204e554c4c2044454641554c5420276d656469756d272c0a20207374617475732054455854204e4f54204e554c4c2044454641554c54202770656e64696e67272c0a20206475655f6461746520444154452c0a2020636f6d706c657465645f61742054494d455354414d5020574954482054494d45205a4f4e452c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000000462d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e6461696c795f7461736b7320454e41424c4520524f57204c4556454c205345435552495459000000b72d2d2043726561746520524c5320706f6c69636965730a43524541544520504f4c494359202255736572732063616e20766965772074686569722061737369676e6564207461736b73220a4f4e207075626c69632e6461696c795f7461736b730a464f522053454c4543540a5553494e472028617574682e7569642829203d2061737369676e65645f746f204f52206861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000007d43524541544520504f4c494359202241646d696e732063616e20696e73657274207461736b73220a4f4e207075626c69632e6461696c795f7461736b730a464f5220494e534552540a5749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000009d43524541544520504f4c494359202255736572732063616e20757064617465207468656972206f776e207461736b73220a4f4e207075626c69632e6461696c795f7461736b730a464f52205550444154450a5553494e472028617574682e7569642829203d2061737369676e65645f746f204f52206861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c6529290000007843524541544520504f4c494359202241646d696e732063616e2064656c657465207461736b73220a4f4e207075626c69632e6461696c795f7461736b730a464f522044454c4554450a5553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929000000b62d2d20437265617465207472696767657220666f7220757064617465645f61740a4352454154452054524947474552207570646174655f6461696c795f7461736b735f757064617465645f61740a4245464f524520555044415445204f4e207075626c69632e6461696c795f7461736b730a464f52204541434820524f570a455845435554452046554e4354494f4e207075626c69632e7570646174655f6461696c795f7461736b735f757064617465645f617428290000005d2d2d2043726561746520696e64657865730a43524541544520494e444558206964785f6461696c795f7461736b735f61737369676e65645f746f204f4e207075626c69632e6461696c795f7461736b732861737369676e65645f746f290000004143524541544520494e444558206964785f6461696c795f7461736b735f737461747573204f4e207075626c69632e6461696c795f7461736b7328737461747573290000004543524541544520494e444558206964785f6461696c795f7461736b735f6475655f64617465204f4e207075626c69632e6461696c795f7461736b73286475655f6461746529"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251205184058_250a2135-a1e5-4dcb-a5c0-e15fa63764c3.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_templates table\nCREATE TABLE public.content_templates (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  category TEXT NOT NULL,\n  title TEXT NOT NULL,\n  description TEXT,\n  content TEXT NOT NULL,\n  language TEXT NOT NULL DEFAULT 'pt-BR',\n  niche TEXT,\n  version INTEGER NOT NULL DEFAULT 1,\n  status TEXT NOT NULL DEFAULT 'draft',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_approvals table\nCREATE TABLE public.content_approvals (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  template_id UUID NOT NULL REFERENCES public.content_templates(id) ON DELETE CASCADE,\n  reviewer_name TEXT NOT NULL,\n  reviewer_email TEXT,\n  reviewer_type TEXT NOT NULL DEFAULT 'client',\n  status TEXT NOT NULL,\n  comments TEXT,\n  approved_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_comments table\nCREATE TABLE public.content_comments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  template_id UUID NOT NULL REFERENCES public.content_templates(id) ON DELETE CASCADE,\n  commenter_name TEXT NOT NULL,\n  commenter_email TEXT,\n  comment TEXT NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.content_templates ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE public.content_approvals ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE public.content_comments ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS Policies for content_templates\nCREATE POLICY \"Public can view templates\" ON public.content_templates FOR SELECT USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can manage templates\" ON public.content_templates FOR ALL USING (has_role(auth.uid(), 'admin'::app_role)) WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS Policies for content_approvals (anyone can submit approvals for review workflow)\nCREATE POLICY \"Public can view approvals\" ON public.content_approvals FOR SELECT USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Public can insert approvals\" ON public.content_approvals FOR INSERT WITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can manage approvals\" ON public.content_approvals FOR ALL USING (has_role(auth.uid(), 'admin'::app_role)) WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS Policies for content_comments (anyone can comment for review workflow)\nCREATE POLICY \"Public can view comments\" ON public.content_comments FOR SELECT USING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Public can insert comments\" ON public.content_comments FOR INSERT WITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Admins can manage comments\" ON public.content_comments FOR ALL USING (has_role(auth.uid(), 'admin'::app_role)) WITH CHECK (has_role(auth.uid(), 'admin'::app_role))","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create trigger for updated_at on content_templates\nCREATE OR REPLACE FUNCTION public.update_content_templates_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE TRIGGER update_content_templates_updated_at\nBEFORE UPDATE ON public.content_templates\nFOR EACH ROW\nEXECUTE FUNCTION public.update_content_templates_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create indexes\nCREATE INDEX idx_content_templates_category ON public.content_templates(category)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_templates_status ON public.content_templates(status)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_approvals_template_id ON public.content_approvals(template_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_comments_template_id ON public.content_comments(template_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251205184058"},{"text":"250a2135-a1e5-4dcb-a5c0-e15fa63764c3"},{"binary":"0000000100000000000000190000001400000001000001e42d2d2043726561746520636f6e74656e745f74656d706c61746573207461626c650a435245415445205441424c45207075626c69632e636f6e74656e745f74656d706c6174657320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202063617465676f72792054455854204e4f54204e554c4c2c0a20207469746c652054455854204e4f54204e554c4c2c0a20206465736372697074696f6e20544558542c0a2020636f6e74656e742054455854204e4f54204e554c4c2c0a20206c616e67756167652054455854204e4f54204e554c4c2044454641554c54202770742d4252272c0a20206e6963686520544558542c0a202076657273696f6e20494e5445474552204e4f54204e554c4c2044454641554c5420312c0a20207374617475732054455854204e4f54204e554c4c2044454641554c5420276472616674272c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000001d02d2d2043726561746520636f6e74656e745f617070726f76616c73207461626c650a435245415445205441424c45207075626c69632e636f6e74656e745f617070726f76616c7320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202074656d706c6174655f69642055554944204e4f54204e554c4c205245464552454e434553207075626c69632e636f6e74656e745f74656d706c6174657328696429204f4e2044454c45544520434153434144452c0a202072657669657765725f6e616d652054455854204e4f54204e554c4c2c0a202072657669657765725f656d61696c20544558542c0a202072657669657765725f747970652054455854204e4f54204e554c4c2044454641554c542027636c69656e74272c0a20207374617475732054455854204e4f54204e554c4c2c0a2020636f6d6d656e747320544558542c0a2020617070726f7665645f61742054494d455354414d5020574954482054494d45205a4f4e452c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000001682d2d2043726561746520636f6e74656e745f636f6d6d656e7473207461626c650a435245415445205441424c45207075626c69632e636f6e74656e745f636f6d6d656e747320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202074656d706c6174655f69642055554944204e4f54204e554c4c205245464552454e434553207075626c69632e636f6e74656e745f74656d706c6174657328696429204f4e2044454c45544520434153434144452c0a2020636f6d6d656e7465725f6e616d652054455854204e4f54204e554c4c2c0a2020636f6d6d656e7465725f656d61696c20544558542c0a2020636f6d6d656e742054455854204e4f54204e554c4c2c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a290000004c2d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e636f6e74656e745f74656d706c6174657320454e41424c4520524f57204c4556454c2053454355524954590000003e414c544552205441424c45207075626c69632e636f6e74656e745f617070726f76616c7320454e41424c4520524f57204c4556454c2053454355524954590000003d414c544552205441424c45207075626c69632e636f6e74656e745f636f6d6d656e747320454e41424c4520524f57204c4556454c205345435552495459000000832d2d20524c5320506f6c696369657320666f7220636f6e74656e745f74656d706c617465730a43524541544520504f4c49435920225075626c69632063616e20766965772074656d706c6174657322204f4e207075626c69632e636f6e74656e745f74656d706c6174657320464f522053454c454354205553494e4720287472756529000000b443524541544520504f4c494359202241646d696e732063616e206d616e6167652074656d706c6174657322204f4e207075626c69632e636f6e74656e745f74656d706c6174657320464f5220414c4c205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929000000b52d2d20524c5320506f6c696369657320666f7220636f6e74656e745f617070726f76616c732028616e796f6e652063616e207375626d697420617070726f76616c7320666f722072657669657720776f726b666c6f77290a43524541544520504f4c49435920225075626c69632063616e207669657720617070726f76616c7322204f4e207075626c69632e636f6e74656e745f617070726f76616c7320464f522053454c454354205553494e47202874727565290000006443524541544520504f4c49435920225075626c69632063616e20696e7365727420617070726f76616c7322204f4e207075626c69632e636f6e74656e745f617070726f76616c7320464f5220494e53455254205749544820434845434b20287472756529000000b443524541544520504f4c494359202241646d696e732063616e206d616e61676520617070726f76616c7322204f4e207075626c69632e636f6e74656e745f617070726f76616c7320464f5220414c4c205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929000000a92d2d20524c5320506f6c696369657320666f7220636f6e74656e745f636f6d6d656e74732028616e796f6e652063616e20636f6d6d656e7420666f722072657669657720776f726b666c6f77290a43524541544520504f4c49435920225075626c69632063616e207669657720636f6d6d656e747322204f4e207075626c69632e636f6e74656e745f636f6d6d656e747320464f522053454c454354205553494e47202874727565290000006243524541544520504f4c49435920225075626c69632063616e20696e7365727420636f6d6d656e747322204f4e207075626c69632e636f6e74656e745f636f6d6d656e747320464f5220494e53455254205749544820434845434b20287472756529000000b243524541544520504f4c494359202241646d696e732063616e206d616e61676520636f6d6d656e747322204f4e207075626c69632e636f6e74656e745f636f6d6d656e747320464f5220414c4c205553494e4720286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929205749544820434845434b20286861735f726f6c6528617574682e75696428292c202761646d696e273a3a6170705f726f6c652929000000f32d2d20437265617465207472696767657220666f7220757064617465645f6174206f6e20636f6e74656e745f74656d706c617465730a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e7570646174655f636f6e74656e745f74656d706c617465735f757064617465645f617428290a52455455524e5320545249474745522041532024240a424547494e0a20204e45572e757064617465645f6174203d206e6f7728293b0a202052455455524e204e45573b0a454e443b0a2424204c414e475541474520706c706773716c20534554207365617263685f70617468203d207075626c6963000000a74352454154452054524947474552207570646174655f636f6e74656e745f74656d706c617465735f757064617465645f61740a4245464f524520555044415445204f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f52204541434820524f570a455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e74656e745f74656d706c617465735f757064617465645f61742829000000632d2d2043726561746520696e64657865730a43524541544520494e444558206964785f636f6e74656e745f74656d706c617465735f63617465676f7279204f4e207075626c69632e636f6e74656e745f74656d706c617465732863617465676f7279290000004d43524541544520494e444558206964785f636f6e74656e745f74656d706c617465735f737461747573204f4e207075626c69632e636f6e74656e745f74656d706c6174657328737461747573290000005743524541544520494e444558206964785f636f6e74656e745f617070726f76616c735f74656d706c6174655f6964204f4e207075626c69632e636f6e74656e745f617070726f76616c732874656d706c6174655f6964290000005543524541544520494e444558206964785f636f6e74656e745f636f6d6d656e74735f74656d706c6174655f6964204f4e207075626c69632e636f6e74656e745f636f6d6d656e74732874656d706c6174655f696429"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20251205_content_approval.sql...
2025/12/16 11:10:40 PG Send: {"Type":"Query","String":"RESET ALL"}
2025/12/16 11:10:40 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_templates table for storing prompts and templates\nCREATE TABLE public.content_templates (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  category TEXT NOT NULL, -- 'email_reply', 'linkedin_outreach', 'cold_email', 'carousel_content', 'crm_agent', 'personalized_outreach'\n  title TEXT NOT NULL,\n  description TEXT,\n  content TEXT NOT NULL,\n  language TEXT NOT NULL DEFAULT 'pt-BR', -- 'pt-BR' or 'en'\n  niche TEXT, -- 'orthopedic', 'dental', 'veterinary', 'hospital', 'oem', 'general'\n  version INTEGER NOT NULL DEFAULT 1,\n  status TEXT NOT NULL DEFAULT 'draft', -- 'draft', 'pending_approval', 'approved', 'rejected', 'archived'\n  created_by UUID REFERENCES auth.users(id),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_approvals table for tracking approval workflow\nCREATE TABLE public.content_approvals (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  template_id UUID NOT NULL REFERENCES public.content_templates(id) ON DELETE CASCADE,\n  reviewer_name TEXT NOT NULL,\n  reviewer_email TEXT,\n  reviewer_type TEXT NOT NULL DEFAULT 'internal', -- 'internal' or 'client'\n  status TEXT NOT NULL DEFAULT 'pending', -- 'pending', 'approved', 'rejected', 'changes_requested'\n  comments TEXT,\n  approved_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create content_comments table for feedback\nCREATE TABLE public.content_comments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  template_id UUID NOT NULL REFERENCES public.content_templates(id) ON DELETE CASCADE,\n  approval_id UUID REFERENCES public.content_approvals(id) ON DELETE CASCADE,\n  commenter_name TEXT NOT NULL,\n  commenter_email TEXT,\n  comment TEXT NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Enable RLS\nALTER TABLE public.content_templates ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE public.content_approvals ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE public.content_comments ENABLE ROW LEVEL SECURITY","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS policies for content_templates (allow public read for now, can be restricted later)\nCREATE POLICY \"Anyone can view templates\"\nON public.content_templates\nFOR SELECT\nUSING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can insert templates\"\nON public.content_templates\nFOR INSERT\nWITH CHECK (auth.role() = 'authenticated')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can update templates\"\nON public.content_templates\nFOR UPDATE\nUSING (auth.role() = 'authenticated')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Authenticated users can delete templates\"\nON public.content_templates\nFOR DELETE\nUSING (auth.role() = 'authenticated')","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS policies for content_approvals\nCREATE POLICY \"Anyone can view approvals\"\nON public.content_approvals\nFOR SELECT\nUSING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Anyone can insert approvals\"\nON public.content_approvals\nFOR INSERT\nWITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Anyone can update approvals\"\nON public.content_approvals\nFOR UPDATE\nUSING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS policies for content_comments\nCREATE POLICY \"Anyone can view comments\"\nON public.content_comments\nFOR SELECT\nUSING (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE POLICY \"Anyone can insert comments\"\nON public.content_comments\nFOR INSERT\nWITH CHECK (true)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create indexes\nCREATE INDEX idx_content_templates_category ON public.content_templates(category)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_templates_status ON public.content_templates(status)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Recv: {"Type":"ParseComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"BindComplete"}
2025/12/16 11:10:40 PG Recv: {"Type":"NoData"}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_templates_niche ON public.content_templates(niche)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Recv: {"Type":"ErrorResponse","Severity":"ERROR","SeverityUnlocalized":"ERROR","Code":"42P07","Message":"relation \"content_templates\" already exists","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"heap.c","Line":1160,"Routine":"heap_create_with_catalog","UnknownFields":null}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_approvals_template_id ON public.content_approvals(template_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_approvals_status ON public.content_approvals(status)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE INDEX idx_content_comments_template_id ON public.content_comments(template_id)","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create function to update timestamps\nCREATE OR REPLACE FUNCTION public.update_content_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"-- Create triggers for updated_at\nCREATE TRIGGER update_content_templates_updated_at\nBEFORE UPDATE ON public.content_templates\nFOR EACH ROW\nEXECUTE FUNCTION public.update_content_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"CREATE TRIGGER update_content_approvals_updated_at\nBEFORE UPDATE ON public.content_approvals\nFOR EACH ROW\nEXECUTE FUNCTION public.update_content_updated_at()","ParameterOIDs":null}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2025/12/16 11:10:40 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20251205"},{"text":"content_approval"},{"binary":"00000001000000000000001900000018000000010000033d2d2d2043726561746520636f6e74656e745f74656d706c61746573207461626c6520666f722073746f72696e672070726f6d70747320616e642074656d706c617465730a435245415445205441424c45207075626c69632e636f6e74656e745f74656d706c6174657320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202063617465676f72792054455854204e4f54204e554c4c2c202d2d2027656d61696c5f7265706c79272c20276c696e6b6564696e5f6f75747265616368272c2027636f6c645f656d61696c272c20276361726f7573656c5f636f6e74656e74272c202763726d5f6167656e74272c2027706572736f6e616c697a65645f6f75747265616368270a20207469746c652054455854204e4f54204e554c4c2c0a20206465736372697074696f6e20544558542c0a2020636f6e74656e742054455854204e4f54204e554c4c2c0a20206c616e67756167652054455854204e4f54204e554c4c2044454641554c54202770742d4252272c202d2d202770742d425227206f722027656e270a20206e6963686520544558542c202d2d20276f7274686f7065646963272c202764656e74616c272c20277665746572696e617279272c2027686f73706974616c272c20276f656d272c202767656e6572616c270a202076657273696f6e20494e5445474552204e4f54204e554c4c2044454641554c5420312c0a20207374617475732054455854204e4f54204e554c4c2044454641554c5420276472616674272c202d2d20276472616674272c202770656e64696e675f617070726f76616c272c2027617070726f766564272c202772656a6563746564272c20276172636869766564270a2020637265617465645f62792055554944205245464552454e43455320617574682e7573657273286964292c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000002952d2d2043726561746520636f6e74656e745f617070726f76616c73207461626c6520666f7220747261636b696e6720617070726f76616c20776f726b666c6f770a435245415445205441424c45207075626c69632e636f6e74656e745f617070726f76616c7320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202074656d706c6174655f69642055554944204e4f54204e554c4c205245464552454e434553207075626c69632e636f6e74656e745f74656d706c6174657328696429204f4e2044454c45544520434153434144452c0a202072657669657765725f6e616d652054455854204e4f54204e554c4c2c0a202072657669657765725f656d61696c20544558542c0a202072657669657765725f747970652054455854204e4f54204e554c4c2044454641554c542027696e7465726e616c272c202d2d2027696e7465726e616c27206f722027636c69656e74270a20207374617475732054455854204e4f54204e554c4c2044454641554c54202770656e64696e67272c202d2d202770656e64696e67272c2027617070726f766564272c202772656a6563746564272c20276368616e6765735f726571756573746564270a2020636f6d6d656e747320544558542c0a2020617070726f7665645f61742054494d455354414d5020574954482054494d45205a4f4e452c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728292c0a2020757064617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a29000001c32d2d2043726561746520636f6e74656e745f636f6d6d656e7473207461626c6520666f7220666565646261636b0a435245415445205441424c45207075626c69632e636f6e74656e745f636f6d6d656e747320280a202069642055554944204e4f54204e554c4c2044454641554c542067656e5f72616e646f6d5f757569642829205052494d415259204b45592c0a202074656d706c6174655f69642055554944204e4f54204e554c4c205245464552454e434553207075626c69632e636f6e74656e745f74656d706c6174657328696429204f4e2044454c45544520434153434144452c0a2020617070726f76616c5f69642055554944205245464552454e434553207075626c69632e636f6e74656e745f617070726f76616c7328696429204f4e2044454c45544520434153434144452c0a2020636f6d6d656e7465725f6e616d652054455854204e4f54204e554c4c2c0a2020636f6d6d656e7465725f656d61696c20544558542c0a2020636f6d6d656e742054455854204e4f54204e554c4c2c0a2020637265617465645f61742054494d455354414d5020574954482054494d45205a4f4e45204e4f54204e554c4c2044454641554c54206e6f7728290a290000004c2d2d20456e61626c6520524c530a414c544552205441424c45207075626c69632e636f6e74656e745f74656d706c6174657320454e41424c4520524f57204c4556454c2053454355524954590000003e414c544552205441424c45207075626c69632e636f6e74656e745f617070726f76616c7320454e41424c4520524f57204c4556454c2053454355524954590000003d414c544552205441424c45207075626c69632e636f6e74656e745f636f6d6d656e747320454e41424c4520524f57204c4556454c205345435552495459000000b82d2d20524c5320706f6c696369657320666f7220636f6e74656e745f74656d706c617465732028616c6c6f77207075626c6963207265616420666f72206e6f772c2063616e2062652072657374726963746564206c61746572290a43524541544520504f4c4943592022416e796f6e652063616e20766965772074656d706c61746573220a4f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f522053454c4543540a5553494e47202874727565290000008a43524541544520504f4c494359202241757468656e746963617465642075736572732063616e20696e736572742074656d706c61746573220a4f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f5220494e534552540a5749544820434845434b2028617574682e726f6c652829203d202761757468656e7469636174656427290000008543524541544520504f4c494359202241757468656e746963617465642075736572732063616e207570646174652074656d706c61746573220a4f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f52205550444154450a5553494e472028617574682e726f6c652829203d202761757468656e7469636174656427290000008543524541544520504f4c494359202241757468656e746963617465642075736572732063616e2064656c6574652074656d706c61746573220a4f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f522044454c4554450a5553494e472028617574682e726f6c652829203d202761757468656e746963617465642729000000832d2d20524c5320706f6c696369657320666f7220636f6e74656e745f617070726f76616c730a43524541544520504f4c4943592022416e796f6e652063616e207669657720617070726f76616c73220a4f4e207075626c69632e636f6e74656e745f617070726f76616c730a464f522053454c4543540a5553494e47202874727565290000006443524541544520504f4c4943592022416e796f6e652063616e20696e7365727420617070726f76616c73220a4f4e207075626c69632e636f6e74656e745f617070726f76616c730a464f5220494e534552540a5749544820434845434b202874727565290000005f43524541544520504f4c4943592022416e796f6e652063616e2075706461746520617070726f76616c73220a4f4e207075626c69632e636f6e74656e745f617070726f76616c730a464f52205550444154450a5553494e4720287472756529000000802d2d20524c5320706f6c696369657320666f7220636f6e74656e745f636f6d6d656e74730a43524541544520504f4c4943592022416e796f6e652063616e207669657720636f6d6d656e7473220a4f4e207075626c69632e636f6e74656e745f636f6d6d656e74730a464f522053454c4543540a5553494e47202874727565290000006243524541544520504f4c4943592022416e796f6e652063616e20696e7365727420636f6d6d656e7473220a4f4e207075626c69632e636f6e74656e745f636f6d6d656e74730a464f5220494e534552540a5749544820434845434b20287472756529000000632d2d2043726561746520696e64657865730a43524541544520494e444558206964785f636f6e74656e745f74656d706c617465735f63617465676f7279204f4e207075626c69632e636f6e74656e745f74656d706c617465732863617465676f7279290000004d43524541544520494e444558206964785f636f6e74656e745f74656d706c617465735f737461747573204f4e207075626c69632e636f6e74656e745f74656d706c6174657328737461747573290000004b43524541544520494e444558206964785f636f6e74656e745f74656d706c617465735f6e69636865204f4e207075626c69632e636f6e74656e745f74656d706c61746573286e69636865290000005743524541544520494e444558206964785f636f6e74656e745f617070726f76616c735f74656d706c6174655f6964204f4e207075626c69632e636f6e74656e745f617070726f76616c732874656d706c6174655f6964290000004d43524541544520494e444558206964785f636f6e74656e745f617070726f76616c735f737461747573204f4e207075626c69632e636f6e74656e745f617070726f76616c7328737461747573290000005543524541544520494e444558206964785f636f6e74656e745f636f6d6d656e74735f74656d706c6174655f6964204f4e207075626c69632e636f6e74656e745f636f6d6d656e74732874656d706c6174655f696429000000ec2d2d204372656174652066756e6374696f6e20746f207570646174652074696d657374616d70730a435245415445204f52205245504c4143452046554e4354494f4e207075626c69632e7570646174655f636f6e74656e745f757064617465645f617428290a52455455524e5320545249474745522041532024240a424547494e0a20204e45572e757064617465645f6174203d206e6f7728293b0a202052455455524e204e45573b0a454e443b0a2424204c414e475541474520706c706773716c20534543555249545920444546494e455220534554207365617263685f70617468203d207075626c6963000000bf2d2d2043726561746520747269676765727320666f7220757064617465645f61740a4352454154452054524947474552207570646174655f636f6e74656e745f74656d706c617465735f757064617465645f61740a4245464f524520555044415445204f4e207075626c69632e636f6e74656e745f74656d706c617465730a464f52204541434820524f570a455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e74656e745f757064617465645f617428290000009d4352454154452054524947474552207570646174655f636f6e74656e745f617070726f76616c735f757064617465645f61740a4245464f524520555044415445204f4e207075626c69632e636f6e74656e745f617070726f76616c730a464f52204541434820524f570a455845435554452046554e4354494f4e207075626c69632e7570646174655f636f6e74656e745f757064617465645f61742829"}],"ResultFormatCodes":[]}
2025/12/16 11:10:40 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2025/12/16 11:10:40 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2025/12/16 11:10:40 PG Send: {"Type":"Sync"}
2025/12/16 11:10:40 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Stopping containers...
2025/12/16 11:10:40 PG Send: {"Type":"Terminate"}
Pruned containers: [7f30d31cfedc10dd50f7a85b72600845facc6c409d9f4c2e5a2db2028ac879fd]
Pruned volumes: [supabase_db_vthutqgjrldmarqgxcou supabase_config_vthutqgjrldmarqgxcou]
Pruned network: [supabase_network_vthutqgjrldmarqgxcou]
ERROR: relation "content_templates" already exists (SQLSTATE 42P07)                                                                    
At statement: 0                                                                                                                        
-- Create content_templates table for storing prompts and templates                                                                    
CREATE TABLE public.content_templates (                                                                                                
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,                                                                              
  category TEXT NOT NULL, -- 'email_reply', 'linkedin_outreach', 'cold_email', 'carousel_content', 'crm_agent', 'personalized_outreach'
  title TEXT NOT NULL,                                                                                                                 
  description TEXT,                                                                                                                    
  content TEXT NOT NULL,                                                                                                               
  language TEXT NOT NULL DEFAULT 'pt-BR', -- 'pt-BR' or 'en'                                                                           
  niche TEXT, -- 'orthopedic', 'dental', 'veterinary', 'hospital', 'oem', 'general'                                                    
  version INTEGER NOT NULL DEFAULT 1,                                                                                                  
  status TEXT NOT NULL DEFAULT 'draft', -- 'draft', 'pending_approval', 'approved', 'rejected', 'archived'                             
  created_by UUID REFERENCES auth.users(id),                                                                                           
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),                                                                          
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()                                                                           
)                                                                                                                                      
